{"version":3,"sources":["../../../src/components/AdaptivityProvider/AdaptivityProvider.tsx"],"names":["React","hasMouse","_hasMouse","AdaptivityContext","SizeType","ViewHeight","ViewWidth","useDOM","DESKTOP_SIZE","TABLET_SIZE","SMALL_TABLET_SIZE","MOBILE_SIZE","MOBILE_LANDSCAPE_HEIGHT","MEDIUM_HEIGHT","AdaptivityProvider","props","adaptivityRef","useRef","useState","updateAdaptivity","window","current","calculateAdaptivity","innerWidth","innerHeight","useEffect","onResize","calculated","viewWidth","viewHeight","sizeX","sizeY","addEventListener","removeEventListener","children","windowWidth","windowHeight","SMALL_MOBILE","SMALL","REGULAR","DESKTOP","TABLET","SMALL_TABLET","MOBILE","MEDIUM","EXTRA_SMALL","COMPACT"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { hasMouse as _hasMouse } from '@vkontakte/vkjs';\nimport { AdaptivityContext, AdaptivityContextInterface, SizeType, ViewHeight, ViewWidth } from './AdaptivityContext';\nimport { useDOM } from '../../lib/dom';\n\nexport interface AdaptivityProviderProps extends AdaptivityContextInterface {\n  children?: React.ReactNode;\n}\n\nexport const DESKTOP_SIZE = 1280;\nexport const TABLET_SIZE = 1024;\nexport const SMALL_TABLET_SIZE = 768;\nexport const MOBILE_SIZE = 320;\n\nexport const MOBILE_LANDSCAPE_HEIGHT = 414;\nexport const MEDIUM_HEIGHT = 720;\n\nexport default function AdaptivityProvider(props: AdaptivityProviderProps) {\n  const adaptivityRef = React.useRef<AdaptivityContextInterface>(null);\n  const [, updateAdaptivity] = React.useState({});\n\n  const { window } = useDOM();\n\n  if (!adaptivityRef.current) {\n    adaptivityRef.current = calculateAdaptivity(\n      window ? window.innerWidth : 0,\n      window ? window.innerHeight : 0,\n      props,\n    );\n  }\n\n  React.useEffect(() => {\n    function onResize() {\n      const calculated = calculateAdaptivity(window.innerWidth, window.innerHeight, props);\n      const { viewWidth, viewHeight, sizeX, sizeY, hasMouse } = adaptivityRef.current;\n\n      if (\n        viewWidth !== calculated.viewWidth ||\n        viewHeight !== calculated.viewHeight ||\n        sizeX !== calculated.sizeX ||\n        sizeY !== calculated.sizeY ||\n        hasMouse !== calculated.hasMouse\n      ) {\n        adaptivityRef.current = calculated;\n        updateAdaptivity({});\n      }\n    }\n\n    onResize();\n    window.addEventListener('resize', onResize, false);\n\n    return () => {\n      window.removeEventListener('resize', onResize, false);\n    };\n  }, [props.viewWidth, props.viewHeight, props.sizeX, props.sizeY, props.hasMouse]);\n\n  return (\n    <AdaptivityContext.Provider value={adaptivityRef.current}>\n      {props.children}\n    </AdaptivityContext.Provider>\n  );\n}\n\nfunction calculateAdaptivity(windowWidth: number, windowHeight: number, props: AdaptivityProviderProps) {\n  let viewWidth = ViewWidth.SMALL_MOBILE;\n  let viewHeight = ViewHeight.SMALL;\n  let sizeY = SizeType.REGULAR;\n  let sizeX = SizeType.REGULAR;\n  let hasMouse = typeof props.hasMouse === 'boolean' ? props.hasMouse : _hasMouse;\n\n  if (windowWidth >= DESKTOP_SIZE) {\n    viewWidth = ViewWidth.DESKTOP;\n  } else if (windowWidth >= TABLET_SIZE) {\n    viewWidth = ViewWidth.TABLET;\n  } else if (windowWidth >= SMALL_TABLET_SIZE) {\n    viewWidth = ViewWidth.SMALL_TABLET;\n  } else if (windowWidth >= MOBILE_SIZE) {\n    viewWidth = ViewWidth.MOBILE;\n  } else {\n    viewWidth = ViewWidth.SMALL_MOBILE;\n  }\n\n  if (windowHeight >= MEDIUM_HEIGHT) {\n    viewHeight = ViewHeight.MEDIUM;\n  } else if (windowHeight > MOBILE_LANDSCAPE_HEIGHT) {\n    viewHeight = ViewHeight.SMALL;\n  } else {\n    viewHeight = ViewHeight.EXTRA_SMALL;\n  }\n\n  props.viewWidth && (viewWidth = props.viewWidth);\n  props.viewHeight && (viewHeight = props.viewHeight);\n\n  if (viewWidth <= ViewWidth.MOBILE) {\n    sizeX = SizeType.COMPACT;\n  }\n\n  if (viewWidth >= ViewWidth.SMALL_TABLET && hasMouse || viewHeight <= ViewHeight.EXTRA_SMALL) {\n    sizeY = SizeType.COMPACT;\n  }\n\n  props.sizeX && (sizeX = props.sizeX);\n  props.sizeY && (sizeY = props.sizeY);\n\n  return { viewWidth, viewHeight, sizeX, sizeY, hasMouse };\n}\n"],"file":"AdaptivityProvider.js"}