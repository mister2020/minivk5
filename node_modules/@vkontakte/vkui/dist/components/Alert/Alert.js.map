{"version":3,"sources":["../../../src/components/Alert/Alert.tsx"],"names":["React","Tappable","PopoutWrapper","getClassName","classNames","transitionEvent","ANDROID","VKCOM","IOS","withPlatform","withAdaptivity","ViewWidth","Button","hasReactNode","Headline","Title","Caption","ModalDismissButton","Alert","props","item","action","autoclose","setState","closing","waitTransitionFinish","e","propertyName","onClose","stopPropagation","i","platform","Component","href","mode","onItemClick","target","title","viewWidth","DESKTOP","element","createRef","state","eventHandler","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","bind","header","text","actions","actionsLayout","children","className","style","restProps","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","renderHeader","renderText","map","renderAction"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport Tappable from '../Tappable/Tappable';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM, IOS } from '../../lib/platform';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Button, { ButtonProps } from '../Button/Button';\nimport { hasReactNode } from '../../lib/utils';\nimport Headline from '../Typography/Headline/Headline';\nimport Title from '../Typography/Title/Title';\nimport Caption from '../Typography/Caption/Caption';\nimport ModalDismissButton from '../ModalDismissButton/ModalDismissButton';\nimport './Alert.css';\n\nexport type AlertActionInterface = AlertProps['actions'][0] & React.AnchorHTMLAttributes<HTMLElement>;\n\nexport interface AlertAction extends Pick<ButtonProps, 'Component' | 'href'> {\n  title: string;\n  action?: VoidFunction;\n  autoclose?: boolean;\n  mode: 'cancel' | 'destructive' | 'default';\n}\n\nexport interface AlertProps extends React.HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: AlertAction[];\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n}\n\nexport interface AlertState {\n  closing: boolean;\n}\n\ntype TransitionEndHandler = (e?: TransitionEvent) => void;\n\ntype ItemClickHander = (item: AlertActionInterface) => () => void;\n\nclass Alert extends React.Component<AlertProps, AlertState> {\n  constructor(props: AlertProps) {\n    super(props);\n    this.element = React.createRef();\n    this.state = {\n      closing: false,\n    };\n  }\n\n  element: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: AlertProps = {\n    actionsLayout: 'horizontal',\n    actions: [],\n  };\n\n  onItemClick: ItemClickHander = (item: AlertActionInterface) => () => {\n    const { action, autoclose } = item;\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish((e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          autoclose && this.props.onClose();\n          action && action();\n        }\n      });\n    } else {\n      action && action();\n    }\n  };\n\n  onClose: VoidFunction = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish((e?: TransitionEvent) => {\n      if (!e || e.propertyName === 'opacity') {\n        this.props.onClose();\n      }\n    });\n  };\n\n  stopPropagation: React.MouseEventHandler = (e: React.SyntheticEvent) => {\n    e.stopPropagation();\n  };\n\n  waitTransitionFinish(eventHandler: TransitionEndHandler) {\n    if (transitionEvent.supported) {\n      this.element.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.element.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  renderHeader(header: React.ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Headline vkuiClass=\"Alert__header\" weight=\"medium\">{header}</Headline>;\n      case IOS:\n        return <Title vkuiClass=\"Alert__header\" weight=\"semibold\" level=\"3\">{header}</Title>;\n      case ANDROID:\n        return <Title vkuiClass=\"Alert__header\" weight=\"medium\" level=\"2\">{header}</Title>;\n    }\n  }\n\n  renderText(text: React.ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Caption vkuiClass=\"Alert__text\" level=\"1\" weight=\"regular\">{text}</Caption>;\n      case IOS:\n        return <Caption vkuiClass=\"Alert__text\" level=\"2\" weight=\"regular\">{text}</Caption>;\n      case ANDROID:\n        return <Headline vkuiClass=\"Alert__text\" weight=\"regular\">{text}</Headline>;\n    }\n  }\n\n  renderAction = (action: AlertActionInterface, i: number) => {\n    const { platform } = this.props;\n\n    if (platform === IOS) {\n      const { Component = 'button' } = action;\n      return (\n        <Tappable\n          Component={action.href ? 'a' : Component}\n          vkuiClass={classNames('Alert__action', `Alert__action--${action.mode}`)}\n          onClick={this.onItemClick(action)}\n          href={action.href}\n          key={`alert-action-${i}`}\n          target={action.target}\n        >\n          {action.title}\n        </Tappable>\n      );\n    }\n\n    let mode: ButtonProps['mode'] = action.mode === 'cancel' ? 'secondary' : 'primary';\n\n    if (platform === ANDROID) {\n      mode = 'tertiary';\n\n      if (this.props.viewWidth === ViewWidth.DESKTOP && action.mode === 'destructive') {\n        mode = 'destructive';\n      }\n    }\n\n    return (\n      <Button\n        vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n        mode={mode}\n        size=\"m\"\n        onClick={this.onItemClick(action)}\n        Component={action.Component}\n        href={action.href}\n        key={`alert-action-${i}`}\n        target={action.target}\n      >\n        {action.title}\n      </Button>\n    );\n  };\n\n  render() {\n    const { actions, actionsLayout, children, className, style, platform, viewWidth, text, header, ...restProps } = this.props;\n    const { closing } = this.state;\n\n    const resolvedActionsLayout: AlertProps['actionsLayout'] = platform === VKCOM ? 'horizontal' : actionsLayout;\n    const canShowCloseButton = platform === VKCOM || platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET;\n    const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n    return (\n      <PopoutWrapper\n        className={className}\n        closing={closing}\n        style={style}\n        onClick={this.onClose}\n      >\n        <div\n          {...restProps}\n          ref={this.element}\n          onClick={this.stopPropagation}\n          vkuiClass={classNames(getClassName('Alert', platform), {\n            'Alert--v': resolvedActionsLayout === 'vertical',\n            'Alert--h': resolvedActionsLayout === 'horizontal',\n            'Alert--closing': closing,\n            'Alert--desktop': isDesktop,\n          })}\n        >\n          {canShowCloseButton && <ModalDismissButton onClick={this.onClose} />}\n          <div vkuiClass=\"Alert__content\">\n            {hasReactNode(header) && this.renderHeader(header)}\n            {hasReactNode(text) && this.renderText(text)}\n            {children}\n          </div>\n          <footer vkuiClass=\"Alert__actions\">\n            {actions.map(this.renderAction)}\n          </footer>\n        </div>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Alert, {\n  viewWidth: true,\n}));\n"],"file":"Alert.js"}