{"version":3,"sources":["../../../src/components/ActionSheet/ActionSheet.tsx"],"names":["React","PopoutWrapper","ViewWidth","ViewHeight","IOS","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","ActionSheetContext","Caption","usePlatform","useTimeout","useAdaptivity","useObjectMemo","ActionSheet","children","className","header","text","style","iosCloseItem","restProps","platform","useState","closing","setClosing","onClose","_closeAction","setCloseAction","afterClose","undefined","viewWidth","viewHeight","hasMouse","isDesktop","SMALL_TABLET","MEDIUM","fallbackTransitionFinish","useEffect","set","clear","onItemClick","useCallback","action","autoclose","event","persist","contextValue","DropdownComponent","defaultProps","popupDirection"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { ViewWidth, ViewHeight } from '../../hoc/withAdaptivity';\nimport { IOS } from '../../lib/platform';\nimport { ActionSheetDropdownDesktop } from './ActionSheetDropdownDesktop';\nimport { ActionSheetDropdown } from './ActionSheetDropdown';\nimport { hasReactNode } from '../../lib/utils';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport Caption from '../Typography/Caption/Caption';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport './ActionSheet.css';\n\nexport type PopupDirectionFunction = (elRef: React.RefObject<HTMLDivElement>) => 'top' | 'bottom';\n\nexport interface ActionSheetProps extends React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n  /**\n   * Desktop only\n   */\n  toggleRef: Element;\n  /**\n   * Desktop only\n   */\n  popupDirection?: 'top' | 'bottom' | PopupDirectionFunction;\n  /**\n   * iOS only\n   */\n  iosCloseItem: React.ReactNode;\n}\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport const ActionSheet: React.FC<ActionSheetProps> = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  ...restProps\n}) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n\n  const [_closeAction, setCloseAction] = React.useState<VoidFunction>();\n  const afterClose = () => {\n    restProps.onClose();\n    _closeAction && _closeAction();\n    setCloseAction(undefined);\n  };\n\n  const { viewWidth, viewHeight, hasMouse } = useAdaptivity();\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET && (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n\n  const fallbackTransitionFinish = useTimeout(afterClose, platform === IOS ? 300 : 200);\n  React.useEffect(() => {\n    if (closing) {\n      if (isDesktop) {\n        afterClose();\n      } else {\n        fallbackTransitionFinish.set();\n      }\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>((action, autoclose) => (event) => {\n    event.persist();\n\n    if (autoclose) {\n      setCloseAction(() => action && action(event));\n      setClosing(true);\n    } else {\n      action && action(event);\n    }\n  }, []);\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop\n    ? ActionSheetDropdownDesktop\n    : ActionSheetDropdown;\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={!isDesktop ? onClose : null}\n      hasMask={!isDesktop}\n      fixed={!isDesktop}\n    >\n      <ActionSheetContext.Provider value={contextValue}>\n        <DropdownComponent\n          closing={closing}\n          onClose={onClose}\n          onTransitionEnd={closing && !isDesktop ? afterClose : null}\n          {...restProps}\n        >\n          {(hasReactNode(header) || hasReactNode(text)) &&\n            <header vkuiClass=\"ActionSheet__header\">\n              {hasReactNode(header) &&\n                <Caption level=\"1\" weight={platform === IOS ? 'semibold' : 'medium'} vkuiClass=\"ActionSheet__title\">\n                  {header}\n                </Caption>\n              }\n              {hasReactNode(text) && <Caption level=\"1\" weight=\"regular\" vkuiClass=\"ActionSheet__text\">{text}</Caption>}\n            </header>\n          }\n          {children}\n          {platform === IOS && !isDesktop && iosCloseItem}\n        </DropdownComponent>\n      </ActionSheetContext.Provider>\n    </PopoutWrapper>\n  );\n};\n\nActionSheet.defaultProps = {\n  popupDirection: 'bottom',\n};\n"],"file":"ActionSheet.js"}