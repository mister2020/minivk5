{"version":3,"sources":["../../../src/components/ModalRoot/ModalRootContext.tsx"],"names":["React","useIsomorphicLayoutEffect","ModalRootContext","createContext","updateModalHeight","undefined","registerModal","isInsideModal","useModalRegistry","id","type","modalContext","useContext","elements","useRef","current","reset","Object","keys","reduce","acc","k","refs","modalElement","e","innerElement","headerElement","contentElement","footerElement"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,yBAAT;AAaA,OAAO,IAAMC,gBAAgB,gBAAGF,KAAK,CAACG,aAAN,CAA+C;AAC7EC,EAAAA,iBAAiB,EAAE;AAAA,WAAMC,SAAN;AAAA,GAD0D;AAE7EC,EAAAA,aAAa,EAAE;AAAA,WAAMD,SAAN;AAAA,GAF8D;AAG7EE,EAAAA,aAAa,EAAE;AAH8D,CAA/C,CAAzB;AAMP;AACA;AACA;;AACA,OAAO,SAASC,gBAAT,CAA0BC,EAA1B,EAAsCC,IAAtC,EAAuD;AAC5D,MAAMC,YAAY,GAAGX,KAAK,CAACY,UAAN,CAAiBV,gBAAjB,CAArB;AACA,MAAMW,QAAQ,GAAGb,KAAK,CAACc,MAAN,CAA4B,EAA5B,EAAgCC,OAAjD;AACAd,EAAAA,yBAAyB,CAAC,YAAM;AAC9BU,IAAAA,YAAY,CAACL,aAAb,iCAAgCO,QAAhC;AAA0CH,MAAAA,IAAI,EAAJA,IAA1C;AAAgDD,MAAAA,EAAE,EAAFA;AAAhD,QAD8B,CAE9B;;AACA,QAAMO,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYL,QAAZ,EAAsBM,MAAtB,CACZ,UAACC,GAAD,EAAMC,CAAN;AAAA,6CAAuCD,GAAvC,2BAA6CC,CAA7C,EAAiD,IAAjD;AAAA,KADY,EAEZ;AAAEX,MAAAA,IAAI,EAAJA,IAAF;AAAQD,MAAAA,EAAE,EAAFA;AAAR,KAFY,CAAd;AAGA,WAAO;AAAA,aAAME,YAAY,CAACL,aAAb,CAA2BU,KAA3B,CAAN;AAAA,KAAP;AACD,GAPwB,EAOtB,EAPsB,CAAzB;AASA,MAAMM,IAAI,GAAGtB,KAAK,CAACc,MAAN,CAAkC;AAC7CS,IAAAA,YAAY,EAAE,sBAACC,CAAD;AAAA,aAAOX,QAAQ,CAACU,YAAT,GAAwBC,CAA/B;AAAA,KAD+B;AAE7CC,IAAAA,YAAY,EAAE,sBAACD,CAAD;AAAA,aAAOX,QAAQ,CAACY,YAAT,GAAwBD,CAA/B;AAAA,KAF+B;AAG7CE,IAAAA,aAAa,EAAE,uBAACF,CAAD;AAAA,aAAOX,QAAQ,CAACa,aAAT,GAAyBF,CAAhC;AAAA,KAH8B;AAI7CG,IAAAA,cAAc,EAAE,wBAACH,CAAD;AAAA,aAAOX,QAAQ,CAACc,cAAT,GAA0BH,CAAjC;AAAA,KAJ6B;AAK7CI,IAAAA,aAAa,EAAE,uBAACJ,CAAD;AAAA,aAAOX,QAAQ,CAACe,aAAT,GAAyBJ,CAAhC;AAAA;AAL8B,GAAlC,EAMVT,OANH;AAOA,SAAO;AAAEO,IAAAA,IAAI,EAAJA;AAAF,GAAP;AACD;AAED,eAAepB,gBAAf","sourcesContent":["import * as React from 'react';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { ModalElements, ModalsStateEntry, ModalType } from './types';\n\nexport type ModalRegistryEntry = ModalElements & Required<Pick<ModalsStateEntry, 'type' | 'id'>>;\ntype ModalRefs = { [k in keyof ModalElements]: (e: ModalElements[k]) => void };\n\nexport interface ModalRootContextInterface {\n  updateModalHeight: VoidFunction;\n  registerModal(data: ModalRegistryEntry): void;\n  onClose?: VoidFunction;\n  isInsideModal: boolean;\n}\n\nexport const ModalRootContext = React.createContext<ModalRootContextInterface>({\n  updateModalHeight: () => undefined,\n  registerModal: () => undefined,\n  isInsideModal: false,\n});\n\n/**\n * All referenced elements must be static\n */\nexport function useModalRegistry(id: string, type: ModalType) {\n  const modalContext = React.useContext(ModalRootContext);\n  const elements = React.useRef<ModalElements>({}).current;\n  useIsomorphicLayoutEffect(() => {\n    modalContext.registerModal({ ...elements, type, id });\n    // unset refs on  unmount to prevent leak\n    const reset = Object.keys(elements).reduce<ModalRegistryEntry>(\n      (acc, k: keyof ModalElements) => ({ ...acc, [k]: null }),\n      { type, id });\n    return () => modalContext.registerModal(reset);\n  }, []);\n\n  const refs = React.useRef<Required<ModalRefs>>({\n    modalElement: (e) => elements.modalElement = e,\n    innerElement: (e) => elements.innerElement = e,\n    headerElement: (e) => elements.headerElement = e,\n    contentElement: (e) => elements.contentElement = e,\n    footerElement: (e) => elements.footerElement = e,\n  }).current;\n  return { refs };\n}\n\nexport default ModalRootContext;\n"],"file":"ModalRootContext.js"}