{"version":3,"sources":["../../../src/components/Tooltip/Tooltip.tsx"],"names":["React","ReactDOM","classNames","getClassName","Subhead","usePopper","tooltipContainerAttr","useExternRef","useDOM","warnOnce","hasReactNode","useGlobalEventListener","isDOMTypeElement","element","isValidElement","type","baseClassName","warn","IS_DEV","process","env","NODE_ENV","SimpleTooltip","forwardRef","ref","mode","header","text","arrowRef","style","attributes","container","arrow","mapAlignX","x","getPlacement","alignX","alignY","filter","p","join","isVerticalPlacement","placement","startsWith","Tooltip","children","isShown","offsetX","offsetY","onClose","cornerOffset","cornerAbsoluteOffset","restProps","useState","tooltipRef","setTooltipRef","tooltipArrowRef","setTooltipArrowRef","target","setTarget","multiChildren","Children","count","primitiveChild","JSON","stringify","Boolean","tooltipContainer","useMemo","closest","strategy","position","Error","arrowOffsetModiifer","name","enabled","phase","fn","state","undefined","modifiersData","y","modifiers","options","offset","padding","styles","document","passive","childRef","props","getRootRef","patchedRef","child","cloneElement","createPortal","el","popper","defaultProps"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport ReactDOM from 'react-dom';\nimport { classNames } from '../../lib/classNames';\nimport { getClassName } from '../../helpers/getClassName';\nimport Subhead from '../Typography/Subhead/Subhead';\nimport { Modifier, usePopper } from 'react-popper';\nimport { Placement } from '@popperjs/core';\nimport { tooltipContainerAttr } from './TooltipContainer';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { useDOM } from '../../lib/dom';\nimport { warnOnce } from '../../lib/warnOnce';\nimport { hasReactNode } from '../../lib/utils';\nimport { useGlobalEventListener } from '../../hooks/useGlobalEventListener';\nimport './Tooltip.css';\n\ninterface SimpleTooltipProps extends Partial<TooltipProps> {\n  target?: HTMLDivElement;\n  arrowRef?: React.Ref<HTMLDivElement>;\n  style?: {\n    arrow: React.CSSProperties;\n    container: React.CSSProperties;\n  };\n  attributes?: {\n    arrow: React.HTMLAttributes<HTMLDivElement>;\n    container: React.HTMLAttributes<HTMLDivElement>;\n  };\n}\n\nconst isDOMTypeElement = (element: React.ReactElement): element is React.DOMElement<any, any> => {\n  return React.isValidElement(element) && typeof element.type === 'string';\n};\n\nconst baseClassName = getClassName('Tooltip');\nconst warn = warnOnce('Tooltip');\nconst IS_DEV = process.env.NODE_ENV === 'development';\n\nconst SimpleTooltip = React.forwardRef<HTMLDivElement, SimpleTooltipProps>(\n  function SimpleTooltip(\n    { mode = 'accent', header, text, arrowRef, style = {}, attributes },\n    ref,\n  ) {\n    return (\n      <div vkuiClass={\n        classNames(\n          baseClassName,\n          `Tooltip--${mode}`,\n        )}>\n        <div vkuiClass=\"Tooltip__container\" ref={ref} style={style.container} {...attributes.container}>\n          <div vkuiClass=\"Tooltip__corner\" style={style.arrow} {...attributes.arrow} ref={arrowRef} />\n          <div vkuiClass=\"Tooltip__content\">\n            {header && <Subhead weight=\"semibold\" vkuiClass=\"Tooltip__title\">{header}</Subhead>}\n            {text && <Subhead weight=\"regular\" vkuiClass=\"Tooltip__text\">{text}</Subhead>}\n          </div>\n        </div>\n      </div>\n    );\n  });\n\nexport interface TooltipProps {\n  /**\n   * **Важно**: если в `children` передан React-компонент, то необходимо убедиться в том, что он поддерживает\n   * свойство `getRootRef`, которое должно возвращаться ссылку на корневой DOM-элемент компонента,\n   * иначе тултип показан не будет. Если передан React-element, то такой проблемы нет.\n   */\n  children: React.ReactElement;\n  mode?: 'accent' | 'light';\n  /**\n   * Если передан `false`, то рисуется просто `children`.\n   */\n  isShown?: boolean;\n  /**\n   * Текст тултипа.\n   */\n  text?: React.ReactNode;\n  /**\n   * Заголовок тултипа.\n   */\n  header?: React.ReactNode;\n  /**\n   * Положение по горизонтали (прижатие к левому или правому краю `children`).\n   * Если не задано, позиция по горизонтали определятся автоматически\n   */\n  alignX?: 'center' | 'left' | 'right';\n  /**\n   * Положение по вертикали (расположение над или под `children`).\n   * Если не задано, позиция по вертикали определятся автоматически\n   */\n  alignY?: 'top' | 'bottom';\n  /**\n   * Сдвиг по горизонтали (относительно портала, в котором рисуется тултип).\n   */\n  offsetX?: number;\n  /**\n   * Сдвиг по вертикали (относительно портала, в котором рисуется тултип).\n   */\n  offsetY?: number;\n  /**\n   * Сдвиг стрелочки относительно центра дочернего элемента.\n   */\n  cornerOffset?: number;\n  /**\n   * Сдвиг стрелочки относительно ширины тултипа\n   */\n  cornerAbsoluteOffset?: number;\n  /**\n   * Callback, который вызывается при клике по любому месту в пределах экрана.\n   */\n  onClose?: () => void;\n}\n\ndeclare type ArrowOffsetModifierOptions = {\n  offset: number;\n};\ndeclare type ArrowOffsetModifier = Modifier<'arrowOffset', ArrowOffsetModifierOptions>;\n\nfunction mapAlignX(x: TooltipProps['alignX']) {\n  switch (x) {\n    case 'left': return 'start';\n    case 'right': return 'end';\n    default: return '';\n  }\n}\nfunction getPlacement(alignX: TooltipProps['alignX'], alignY: TooltipProps['alignY']): Placement {\n  return [alignY || 'bottom', mapAlignX(alignX || 'left')].filter((p) => !!p).join('-') as Placement;\n}\nfunction isVerticalPlacement(placement: Placement) {\n  return placement.startsWith('top') || placement.startsWith('bottom');\n}\n\nconst Tooltip: React.FC<TooltipProps> = ({\n  children, isShown, offsetX = 0, offsetY = 15,\n  alignX, alignY, onClose, cornerOffset, cornerAbsoluteOffset,\n  ...restProps\n}) => {\n  const [tooltipRef, setTooltipRef] = React.useState<HTMLElement>();\n  const [tooltipArrowRef, setTooltipArrowRef] = React.useState<HTMLElement>();\n  const [target, setTarget] = React.useState<HTMLElement>();\n\n  if (IS_DEV) {\n    const multiChildren = React.Children.count(children) > 1;\n    // Empty children is a noop\n    const primitiveChild = hasReactNode(children) && typeof children !== 'object';\n    (multiChildren || primitiveChild) && warn([\n      'children must be a single React element, got',\n      multiChildren && 'multiple',\n      primitiveChild && JSON.stringify(children),\n    ].filter(Boolean).join(' '));\n  }\n\n  /* eslint-disable no-restricted-properties */\n  /* eslint-disable @typescript-eslint/no-unnecessary-type-assertion*/\n  const tooltipContainer = React.useMemo(() => target?.closest(`[${tooltipContainerAttr}]`) as HTMLDivElement, [target]);\n  const strategy = React.useMemo(() => target?.style.position === 'fixed' ? 'fixed' : 'absolute', [target]);\n  /* eslint-enable @typescript-eslint/no-unnecessary-type-assertion*/\n  /* eslint-enable no-restricted-properties */\n\n  if (IS_DEV && target && !tooltipContainer) {\n    throw new Error('Use TooltipContainer for Tooltip outside Panel (see docs)');\n  }\n\n  const arrowOffsetModiifer = React.useMemo<ArrowOffsetModifier>(() => {\n    return {\n      name: 'arrowOffset',\n      enabled: true,\n      phase: 'main',\n      fn({ state }) {\n        if (isVerticalPlacement(state.placement)) {\n          if (cornerAbsoluteOffset !== undefined) {\n            state.modifiersData.arrow.x = cornerAbsoluteOffset;\n          } else {\n            state.modifiersData.arrow.x += cornerOffset;\n          }\n        } else {\n          if (cornerAbsoluteOffset !== undefined) {\n            state.modifiersData.arrow.y = cornerAbsoluteOffset;\n          } else {\n            state.modifiersData.arrow.y += cornerOffset;\n          }\n        }\n      },\n    };\n  }, [cornerOffset, cornerAbsoluteOffset]);\n\n  const placement = getPlacement(alignX, alignY);\n  const { styles, attributes } = usePopper(target, tooltipRef, {\n    strategy,\n    placement,\n    modifiers: [\n      {\n        name: 'offset', options: {\n          offset: [\n            offsetX,\n            offsetY,\n          ],\n        },\n      },\n      {\n        name: 'arrow', options: {\n          element: tooltipArrowRef,\n          padding: 14,\n        },\n      },\n      {\n        name: 'preventOverflow',\n      },\n      {\n        name: 'flip',\n      },\n      arrowOffsetModiifer,\n    ],\n  });\n\n  const { document } = useDOM();\n  useGlobalEventListener(document, 'click', isShown && onClose, { passive: true });\n  // NOTE: setting isShown to true used to trigger usePopper().forceUpdate()\n\n  const childRef = React.isValidElement(children) &&\n    (isDOMTypeElement(children) ? children.ref : children.props.getRootRef);\n  const patchedRef = useExternRef(setTarget, childRef);\n  const child = React.isValidElement(children) ? React.cloneElement(children, {\n    [isDOMTypeElement(children) ? 'ref' : 'getRootRef']: patchedRef,\n  }) : children;\n\n  return (\n    <React.Fragment>\n      {child}\n      {isShown && target != null && ReactDOM.createPortal(\n        <SimpleTooltip\n          {...restProps}\n          ref={(el) => setTooltipRef(el)}\n          arrowRef={(el) => setTooltipArrowRef(el)}\n          style={{ arrow: styles.arrow, container: styles.popper }}\n          attributes={{ arrow: attributes.arrow, container: attributes.popper }}\n        />,\n        tooltipContainer,\n      )}\n    </React.Fragment>\n  );\n};\n\nTooltip.defaultProps = {\n  offsetX: 0,\n  offsetY: 15,\n  cornerOffset: 0,\n  isShown: true,\n  mode: 'accent',\n};\nexport default Tooltip;\n"],"file":"Tooltip.js"}