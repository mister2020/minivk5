{"version":3,"sources":["../../../../src/components/FixedLayout/FixedLayout.tsx"],"names":["React","getClassName","classNames","transitionEndEventName","transitionStartEventName","withContext","withPlatform","withPanelContext","setRef","SplitColContext","TooltipContainer","withDOM","IOS","warnOnce","warn","FixedLayout","position","top","bottom","width","e","panelScroll","detail","scrolls","props","panel","Array","isArray","length","fromPanelHasScroll","from","toPanelHasScroll","to","panelAnimated","platform","isBack","canTargetPanelScroll","setState","vertical","el","offsetTop","doResize","colRef","splitCol","current","node","offsetWidth","element","getRootRef","document","window","elem","getPanelNode","process","env","NODE_ENV","panelEl","currentPanel","scrollHeight","clientHeight","onMountResizeTimeout","setTimeout","addEventListener","onViewTransitionStart","onViewTransitionEnd","clearTimeout","removeEventListener","children","style","getRef","filled","restProps","state","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEndEventName, TransitionStartEventDetail, transitionStartEventName } from '../View/View';\nimport { withContext } from '../../hoc/withContext';\nimport { HasPlatform, HasRef, HasRootRef } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withPanelContext } from '../Panel/withPanelContext';\nimport { setRef } from '../../lib/utils';\nimport { SplitColContext, SplitColContextProps } from '../SplitCol/SplitCol';\nimport { TooltipContainer } from '../Tooltip/TooltipContainer';\nimport { PanelContextProps } from '../Panel/PanelContext';\nimport { DOMProps, withDOM } from '../../lib/dom';\nimport { IOS } from '../../lib/platform';\nimport { warnOnce } from '../../lib/warnOnce';\nimport './FixedLayout.css';\n\nexport interface FixedLayoutProps extends\n  React.HTMLAttributes<HTMLDivElement>,\n  HasRootRef<HTMLDivElement>,\n  HasRef<HTMLDivElement>,\n  HasPlatform {\n  vertical?: 'top' | 'bottom';\n  /**\n   * Это свойство определяет, будет ли фон компонента окрашен в цвет фона контента.\n   * Это часто необходимо для фиксированных кнопок в нижней части экрана.\n   */\n  filled?: boolean;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n}\n\nexport interface FixedLayoutState {\n  position: 'absolute' | null;\n  top: number;\n  bottom: number;\n  width: string;\n}\n\nconst warn = warnOnce('FixedLayout');\n\nclass FixedLayout extends React.Component<FixedLayoutProps & DOMProps & PanelContextProps, FixedLayoutState> {\n  state: FixedLayoutState = {\n    position: 'absolute',\n    top: null,\n    bottom: null,\n    width: '',\n  };\n\n  el: HTMLDivElement;\n\n  private onMountResizeTimeout: number;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get currentPanel(): HTMLElement {\n    const elem = this.props.getPanelNode();\n\n    if (process.env.NODE_ENV === 'development' && !elem) {\n      warn('Panel element not found');\n    }\n\n    return elem;\n  }\n\n  get canTargetPanelScroll() {\n    const panelEl = this.currentPanel;\n    if (!panelEl) {\n      return true; // Всегда предпологаем, что может быть скролл в случае, если нет document\n    }\n    return panelEl.scrollHeight > panelEl.clientHeight;\n  }\n\n  componentDidMount() {\n    this.onMountResizeTimeout = setTimeout(() => this.doResize());\n    this.window.addEventListener('resize', this.doResize);\n\n    this.document.addEventListener(transitionStartEventName, this.onViewTransitionStart);\n    this.document.addEventListener(transitionEndEventName, this.onViewTransitionEnd);\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.onMountResizeTimeout);\n    this.window.removeEventListener('resize', this.doResize);\n\n    this.document.removeEventListener(transitionStartEventName, this.onViewTransitionStart);\n    this.document.removeEventListener(transitionEndEventName, this.onViewTransitionEnd);\n  }\n\n  onViewTransitionStart: EventListener = (e: CustomEvent<TransitionStartEventDetail>) => {\n    let panelScroll = e.detail.scrolls[this.props.panel] || 0;\n\n    // support for unstable ViewInfinite\n    if (Array.isArray(panelScroll)) {\n      const scrolls = panelScroll as number[];\n      panelScroll = scrolls[scrolls.length - 1];\n    }\n\n    const fromPanelHasScroll = this.props.panel === e.detail.from && panelScroll > 0;\n    const toPanelHasScroll = this.props.panel === e.detail.to && panelScroll > 0;\n\n    // если переход назад на Android - анимация только у панели с которой уходим (detail.from), и подстраиваться под скролл надо только на ней\n    // на iOS переход между панелями горизонтальный, поэтому там нужно подстраивать хедеры на обеих панелях\n    const panelAnimated = this.props.platform === IOS || !(this.props.panel === e.detail.to && e.detail.isBack);\n\n    // Для панелей, с которых уходим всегда выставляется скролл\n    // Для панелей на которые приходим надо смотреть, есть ли браузерный скролл и применяется ли к ней анимация перехода:\n    if (fromPanelHasScroll || toPanelHasScroll && this.canTargetPanelScroll && panelAnimated) {\n      this.setState({\n        position: 'absolute',\n        top: this.props.vertical === 'top' || fromPanelHasScroll ? this.el.offsetTop + panelScroll : null,\n        bottom: this.props.vertical === 'bottom' && !fromPanelHasScroll ? -panelScroll : null,\n        width: '',\n      });\n    }\n  };\n\n  onViewTransitionEnd: VoidFunction = () => {\n    this.setState({\n      position: null,\n      top: null,\n      bottom: null,\n    });\n\n    this.doResize();\n  };\n\n  doResize = () => {\n    const { colRef } = this.props.splitCol;\n\n    if (colRef && colRef.current) {\n      const node: HTMLElement = colRef.current;\n      const width = node.offsetWidth;\n\n      this.setState({ width: `${width}px`, position: null });\n    } else {\n      this.setState({ width: '', position: null });\n    }\n  };\n\n  getRef: React.RefCallback<HTMLDivElement> = (element) => {\n    this.el = element;\n    setRef(element, this.props.getRootRef);\n  };\n\n  render() {\n    const {\n      children,\n      style,\n      vertical,\n      getRootRef,\n      getRef,\n      platform,\n      filled,\n      splitCol,\n      panel,\n      getPanelNode,\n      window,\n      document,\n      ...restProps\n    } = this.props;\n\n    return (\n      <TooltipContainer\n        {...restProps}\n        fixed\n        ref={this.getRef}\n        vkuiClass={classNames(getClassName('FixedLayout', platform), {\n          'FixedLayout--filled': filled,\n          [`FixedLayout--${vertical}`]: !!vertical,\n        })}\n        style={{ ...style, ...this.state }}\n      >\n        <div vkuiClass=\"FixedLayout__in\" ref={getRef}>{children}</div>\n      </TooltipContainer>\n    );\n  }\n}\n\nexport default withContext(\n  withPlatform(withPanelContext(withDOM<FixedLayoutProps>(FixedLayout))),\n  SplitColContext,\n  'splitCol',\n);\n"],"file":"FixedLayout.js"}