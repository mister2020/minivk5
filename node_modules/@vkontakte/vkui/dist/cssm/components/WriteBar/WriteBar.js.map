{"version":3,"sources":["../../../../src/components/WriteBar/WriteBar.tsx"],"names":["React","usePlatform","useExternRef","hasReactNode","isFunction","useDOM","getClassName","WriteBar","props","platform","className","style","before","inlineAfter","after","value","onChange","getRootRef","getRef","onHeightChange","restProps","isControlledOutside","window","textareaRef","textareaMinHeightRef","useRef","resize","textareaEl","current","offsetHeight","scrollHeight","getComputedStyle","paddingTop","parseInt","paddingBottom","diff","height","String","Math","max","onTextareaChange","event","useEffect","e","preventDefault"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useExternRef } from '../../hooks/useExternRef';\nimport { hasReactNode, isFunction } from '../../lib/utils';\nimport { useDOM } from '../../lib/dom';\nimport { getClassName } from '../../helpers/getClassName';\nimport { HasRef, HasRootRef } from '../../types';\nimport './WriteBar.css';\n\nexport interface WriteBarProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement>, HasRootRef<HTMLDivElement>, HasRef<HTMLTextAreaElement> {\n  /**\n   * Содержимое, отображаемое слево от поля ввода.\n   */\n  before?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое поверх поля ввода (актуально для iOS)\n   */\n  inlineAfter?: React.ReactNode;\n  /**\n   * Содержимое, отображаемое справа от поля ввода\n   */\n  after?: React.ReactNode;\n  /**\n   * Вызывается при смене высоты поля ввода\n   */\n  onHeightChange?: VoidFunction;\n\n  children?: never;\n}\n\nexport const WriteBar: React.FC<WriteBarProps> = (props: WriteBarProps) => {\n  const platform = usePlatform();\n  const {\n    className,\n    style,\n\n    before,\n    inlineAfter,\n    after,\n\n    value,\n    onChange,\n\n    getRootRef,\n    getRef,\n    onHeightChange,\n    ...restProps\n  } = props;\n\n  const isControlledOutside = value != null;\n\n  const { window } = useDOM();\n  const textareaRef = useExternRef(getRef);\n  const textareaMinHeightRef = React.useRef<number | null>(null);\n\n  const resize = () => {\n    const textareaEl = textareaRef.current;\n    if (!textareaEl) {\n      return;\n    }\n\n    const { offsetHeight, scrollHeight } = textareaEl;\n    const style = window.getComputedStyle(textareaEl);\n    const paddingTop = parseInt(style.paddingTop);\n    const paddingBottom = parseInt(style.paddingBottom);\n\n    if (textareaMinHeightRef.current === null) {\n      textareaMinHeightRef.current = offsetHeight;\n    }\n\n    let diff = paddingTop + paddingBottom + 10;\n\n    if (scrollHeight + diff <= offsetHeight) {\n      diff = 0;\n    }\n\n    textareaEl.style.height = '0px';\n\n    const height = textareaEl.scrollHeight - diff / 4;\n    textareaEl.style.height = String(Math.max(height, textareaMinHeightRef.current)) + 'px';\n\n    if (isFunction(onHeightChange)) {\n      onHeightChange();\n    }\n  };\n\n  const onTextareaChange: React.ChangeEventHandler<HTMLTextAreaElement> = (event) => {\n    if (isFunction(onChange)) {\n      onChange(event);\n    }\n\n    if (!isControlledOutside) {\n      resize();\n    }\n  };\n\n  React.useEffect(() => {\n    resize();\n  }, [value]);\n\n  return (\n    <div\n      ref={getRootRef}\n      vkuiClass={getClassName('WriteBar', platform)}\n      className={className}\n      style={style}\n    >\n      <form vkuiClass=\"WriteBar__form\" onSubmit={(e) => e.preventDefault()}>\n        {hasReactNode(before) &&\n        <div vkuiClass=\"WriteBar__before\">\n          {before}\n        </div>\n        }\n\n        <div vkuiClass=\"WriteBar__formIn\">\n          <textarea\n            {...restProps}\n            vkuiClass=\"WriteBar__textarea\"\n            onChange={onTextareaChange}\n            ref={textareaRef}\n            value={value}\n          />\n\n          {hasReactNode(inlineAfter) &&\n          <div vkuiClass=\"WriteBar__inlineAfter\">\n            {inlineAfter}\n          </div>\n          }\n        </div>\n\n        {hasReactNode(after) &&\n        <div vkuiClass=\"WriteBar__after\">\n          {after}\n        </div>\n        }\n      </form>\n    </div>\n  );\n};\n"],"file":"WriteBar.js"}