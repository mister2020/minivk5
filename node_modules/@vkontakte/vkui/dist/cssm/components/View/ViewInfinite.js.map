{"version":3,"sources":["../../../../src/components/View/ViewInfinite.tsx"],"names":["React","classNames","transitionEvent","animationEvent","getClassName","IOS","ANDROID","VKCOM","Touch","withPlatform","withContext","ConfigProviderContext","createCustomEvent","SplitColContext","AppRootPortal","canUseDOM","withDOM","ScrollContext","getNavId","warnOnce","warn","transitionStartEventName","transitionEndEventName","SwipeBackResults","scrollsCache","swipeBackExcludedTags","ViewInfinite","props","e","includes","animationName","activePanel","prevPanel","state","isBack","prevPanelScrolls","scrolls","slice","newPanelScrolls","scrollPosition","pop","document","dispatchEvent","window","setState","nextPanel","visiblePanels","animated","undefined","scroll","scrollTo","onTransition","from","to","propertyName","target","pickPanel","swipeBackNextPanel","swipeBackResult","fail","onSwipeBackCancel","success","onSwipeBackSuccess","originalEvent","tagName","toLowerCase","platform","configProvider","isWebView","startX","innerWidth","browserSwipe","onSwipeBack","swipingBack","history","length","prevScrolls","getScroll","y","swipebackStartX","startT","swipeBackPrevPanel","swipeBackShift","shiftX","speed","Date","now","getTime","Children","toArray","children","id","prevProps","prevState","popout","blurActiveElement","modal","isBackCheck","firstLayerId","panels","map","panel","find","newScrolls","transitionStartEventData","detail","CustomEvent","nextPanelElement","prevPanelElement","scrollTop","getLastPanelScrollPosition","waitAnimationFinish","transitionEndHandler","onSwipeBackStart","waitTransitionFinish","swipingBackTransitionEndHandler","transitionMotionEnabled","splitCol","animate","elem","eventHandler","supported","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","shouldDisableTransitionMotion","animationFinishTimeout","activeElement","blur","panelNodes","panelId","isPrev","isNext","prevPanelTranslate","nextPanelTranslate","prevPanelShadow","boxShadow","transform","WebkitTransform","_1","nav","restProps","hasPopout","hasModal","filter","sort","isPrevPanel","isNextPanel","disableAnimation","modifiers","onMoveX","onEnd","el","calcPanelSwipeStyles","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent, animationEvent } from '../../lib/supportEvents';\nimport { getClassName } from '../../helpers/getClassName';\nimport { IOS, ANDROID, VKCOM } from '../../lib/platform';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withContext } from '../../hoc/withContext';\nimport { ConfigProviderContext, ConfigProviderContextInterface } from '../ConfigProvider/ConfigProviderContext';\nimport { createCustomEvent } from '../../lib/utils';\nimport { SplitColContext, SplitColContextProps } from '../SplitCol/SplitCol';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { canUseDOM, withDOM, DOMProps } from '../../lib/dom';\nimport { ScrollContext, ScrollContextInterface } from '../AppRoot/ScrollContext';\nimport { getNavId, NavIdProps } from '../../lib/getNavId';\nimport { warnOnce } from '../../lib/warnOnce';\nimport './View.css';\n\nconst warn = warnOnce('ViewInfinite');\nexport const transitionStartEventName = 'VKUI:View:transition-start';\nexport const transitionEndEventName = 'VKUI:View:transition-end';\n\nenum SwipeBackResults { fail = 1, success}\n\ninterface Scrolls {\n  [index: string]: number[];\n}\n\nexport type TransitionStartEventDetail = {\n  scrolls: Scrolls;\n  from: string;\n  to: string;\n  isBack: boolean;\n};\n\ninterface ViewsScrolls {\n  [index: string]: Scrolls;\n}\n\ntype AnimationEventHandler = (e?: AnimationEvent) => void;\n\ntype TransitionEventHandler = (e?: TransitionEvent) => void;\n\nlet scrollsCache: ViewsScrolls = {};\n\nconst swipeBackExcludedTags = ['input', 'textarea'];\n\nexport type TransitionParams = { from: string; to: string };\n\nexport interface ViewInfiniteProps extends React.HTMLAttributes<HTMLElement>, HasPlatform, NavIdProps {\n  activePanel: string;\n  popout?: React.ReactNode;\n  modal?: React.ReactNode;\n  onTransition?(params: TransitionParams & { isBack: boolean }): void;\n  /**\n   * callback свайпа назад\n   */\n  onSwipeBack?(): void;\n  /**\n   * callback начала анимации свайпа назад.\n   */\n  onSwipeBackStart?(): void;\n  /**\n   * callback завершения анимации отмененного пользователем свайпа\n   */\n  onSwipeBackCancel?(): void;\n  history?: string[];\n  isBackCheck?(params: TransitionParams): boolean;\n  /**\n   * @ignore\n   */\n  splitCol?: SplitColContextProps;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n  /**\n   * @ignore\n   */\n  scroll?: ScrollContextInterface;\n}\n\nexport interface ViewInfiniteState {\n  scrolls: Scrolls;\n  animated: boolean;\n  startT?: Date;\n\n  visiblePanels: string[];\n  activePanel: string;\n  isBack: boolean;\n  prevPanel: string;\n  nextPanel: string;\n\n  swipingBack: boolean;\n  swipebackStartX: number;\n  swipeBackShift: number;\n  swipeBackNextPanel: string;\n  swipeBackPrevPanel: string;\n  swipeBackResult: SwipeBackResults;\n\n  browserSwipe: boolean;\n}\n\nclass ViewInfinite extends React.Component<ViewInfiniteProps & DOMProps, ViewInfiniteState> {\n  constructor(props: ViewInfiniteProps) {\n    super(props);\n\n    this.state = {\n      scrolls: scrollsCache[getNavId(props, warn)] || {},\n      animated: false,\n\n      visiblePanels: [props.activePanel],\n      activePanel: props.activePanel,\n      isBack: undefined,\n      prevPanel: null,\n      nextPanel: null,\n\n      swipingBack: false,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n      swipeBackNextPanel: null,\n      swipeBackPrevPanel: null,\n      swipeBackResult: null,\n\n      browserSwipe: false,\n    };\n  }\n\n  static defaultProps: Partial<ViewInfiniteProps> = {\n    history: [],\n  };\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n  private animationFinishTimeout: ReturnType<typeof setTimeout>;\n\n  get document() {\n    return this.props.document;\n  }\n\n  get window() {\n    return this.props.window;\n  }\n\n  get panels() {\n    return React.Children.toArray(this.props.children) as React.ReactElement[];\n  }\n\n  panelNodes: { [id: string]: HTMLDivElement } = {};\n\n  componentWillUnmount() {\n    const id = getNavId(this.props);\n    if (id) {\n      scrollsCache[id] = this.state.scrolls;\n    }\n  }\n\n  componentDidUpdate(prevProps: ViewInfiniteProps, prevState: ViewInfiniteState) {\n    this.props.popout && !prevProps.popout && this.blurActiveElement();\n    this.props.modal && !prevProps.modal && this.blurActiveElement();\n\n    // Нужен переход\n    if (prevProps.activePanel !== this.props.activePanel && !prevState.swipingBack && !prevState.browserSwipe) {\n      let isBack = false;\n\n      if (this.props.isBackCheck) {\n        isBack = this.props.isBackCheck({ from: prevProps.activePanel, to: this.props.activePanel });\n      } else {\n        const firstLayerId = this.panels\n          .map((panel) => getNavId(panel.props, warn))\n          .find((id) => id === prevProps.activePanel || id === this.props.activePanel);\n        isBack = firstLayerId === this.props.activePanel;\n      }\n\n      this.blurActiveElement();\n\n      const prevScrolls = prevState.scrolls[prevProps.activePanel] || [];\n      const scrolls = {\n        ...prevState.scrolls,\n        [prevProps.activePanel]: [...prevScrolls, this.props.scroll.getScroll().y],\n      };\n\n      this.setState({\n        visiblePanels: [prevProps.activePanel, this.props.activePanel],\n        prevPanel: prevProps.activePanel,\n        nextPanel: this.props.activePanel,\n        activePanel: null,\n        animated: true,\n        scrolls,\n        isBack,\n      });\n    }\n\n    // Закончилась анимация свайпа назад\n    if (prevProps.activePanel !== this.props.activePanel && prevState.swipingBack) {\n      const nextPanel = this.state.swipeBackNextPanel;\n      const prevPanel = this.state.swipeBackPrevPanel;\n\n      const prevPanelScrolls = [...prevState.scrolls[prevPanel] || []].slice(0, -1);\n      const newPanelScrolls = [...prevState.scrolls[nextPanel] || []];\n      const scrollPosition = newPanelScrolls.pop();\n      const newScrolls = {\n        ...prevState.scrolls || {},\n        [nextPanel]: newPanelScrolls,\n        [prevPanel]: prevPanelScrolls,\n      };\n\n      this.setState({\n        swipeBackPrevPanel: null,\n        swipeBackNextPanel: null,\n        swipingBack: false,\n        swipeBackResult: null,\n        swipebackStartX: 0,\n        swipeBackShift: 0,\n        activePanel: nextPanel,\n        visiblePanels: [nextPanel],\n        scrolls: newScrolls,\n      }, () => {\n        this.document.dispatchEvent(createCustomEvent(this.window, transitionEndEventName));\n        this.props.scroll.scrollTo(0, scrollPosition);\n        prevProps.onTransition && prevProps.onTransition({ isBack: true, from: prevPanel, to: nextPanel });\n      });\n    }\n\n    const scrolls = this.state.scrolls;\n\n    // Начался переход\n    if (!prevState.animated && this.state.animated) {\n      const transitionStartEventData = {\n        detail: {\n          from: this.state.prevPanel,\n          to: this.state.nextPanel,\n          isBack: this.state.isBack,\n          scrolls,\n        },\n      };\n      this.document.dispatchEvent(new (this.window as any).CustomEvent(transitionStartEventName, transitionStartEventData));\n      const nextPanelElement = this.pickPanel(this.state.nextPanel);\n      const prevPanelElement = this.pickPanel(this.state.prevPanel);\n\n      prevPanelElement.scrollTop = this.getLastPanelScrollPosition(scrolls, this.state.prevPanel);\n      if (this.state.isBack) {\n        nextPanelElement.scrollTop = this.getLastPanelScrollPosition(scrolls, this.state.nextPanel);\n      }\n      this.waitAnimationFinish(this.pickPanel(this.state.isBack ? this.state.prevPanel : this.state.nextPanel), this.transitionEndHandler);\n    }\n\n    // Начался свайп назад\n    if (!prevState.swipingBack && this.state.swipingBack) {\n      const transitionStartEventData = {\n        detail: {\n          from: this.state.swipeBackPrevPanel,\n          to: this.state.swipeBackNextPanel,\n          scrolls,\n        },\n      };\n      this.document.dispatchEvent(new (this.window as any).CustomEvent(transitionStartEventName, transitionStartEventData));\n      this.props.onSwipeBackStart && this.props.onSwipeBackStart();\n      const nextPanelElement = this.pickPanel(this.state.swipeBackNextPanel);\n      const prevPanelElement = this.pickPanel(this.state.swipeBackPrevPanel);\n\n      nextPanelElement.scrollTop = this.getLastPanelScrollPosition(scrolls, this.state.swipeBackNextPanel);\n      prevPanelElement.scrollTop = this.getLastPanelScrollPosition(scrolls, this.state.swipeBackPrevPanel);\n    }\n\n    // Началась анимация завершения свайпа назад.\n    if (!prevState.swipeBackResult && this.state.swipeBackResult) {\n      this.waitTransitionFinish(this.pickPanel(this.state.swipeBackNextPanel), this.swipingBackTransitionEndHandler);\n    }\n\n    // Если свайп назад отменился (когда пользователь недостаточно сильно свайпнул)\n    if (prevState.swipeBackResult === SwipeBackResults.fail && !this.state.swipeBackResult) {\n      const newPanelScrolls = [...scrolls[this.state.activePanel] || []];\n      const scrollPosition = newPanelScrolls.pop();\n      const newScrolls = {\n        ...scrolls,\n        [this.state.activePanel]: newPanelScrolls,\n      };\n\n      this.props.scroll.scrollTo(0, scrollPosition);\n\n      this.setState({ scrolls: newScrolls });\n    }\n\n    // Закончился Safari свайп\n    if (prevProps.activePanel !== this.props.activePanel && this.state.browserSwipe) {\n      this.setState({\n        browserSwipe: false,\n        nextPanel: null,\n        prevPanel: null,\n        animated: false,\n        visiblePanels: [this.props.activePanel],\n        activePanel: this.props.activePanel,\n      });\n    }\n  }\n\n  getLastPanelScrollPosition(scrolls: Scrolls, panel: string) {\n    return scrolls[panel]?.length > 0 ? scrolls[panel][scrolls[panel].length - 1] : 0;\n  }\n\n  shouldDisableTransitionMotion(): boolean {\n    return this.props.configProvider.transitionMotionEnabled === false ||\n      !this.props.splitCol.animate;\n  }\n\n  waitTransitionFinish(elem: HTMLElement, eventHandler: TransitionEventHandler): void {\n    if (transitionEvent.supported) {\n      elem.removeEventListener(transitionEvent.name, eventHandler);\n      elem.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n    }\n  }\n\n  waitAnimationFinish(elem: HTMLElement, eventHandler: AnimationEventHandler): void {\n    if (this.shouldDisableTransitionMotion()) {\n      eventHandler();\n      return;\n    }\n\n    if (animationEvent.supported) {\n      elem.removeEventListener(animationEvent.name, eventHandler);\n      elem.addEventListener(animationEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.animationFinishTimeout);\n      this.animationFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 300 : 600);\n    }\n  }\n\n  blurActiveElement(): void {\n    if (typeof this.window !== 'undefined' && this.document.activeElement) {\n      (this.document.activeElement as HTMLElement).blur();\n    }\n  }\n\n  pickPanel(id: string) {\n    return this.panelNodes[id];\n  }\n\n  transitionEndHandler = (e?: AnimationEvent): void => {\n    if (!e || [\n      'vkui-animation-ios-next-forward',\n      'vkui-animation-ios-prev-back',\n      'vkui-animation-view-next-forward',\n      'vkui-animation-view-prev-back',\n    ].includes(e.animationName)) {\n      const activePanel = this.props.activePanel;\n      const prevPanel = this.state.prevPanel;\n      const isBack = this.state.isBack;\n\n      const prevPanelScrolls = [...this.state.scrolls[prevPanel] || []].slice(0, -1);\n      const newPanelScrolls = [...this.state.scrolls[activePanel] || []];\n      const scrollPosition = isBack ? newPanelScrolls.pop() : 0;\n      const scrolls = isBack\n        ? {\n          ...this.state.scrolls || {},\n          [prevPanel]: prevPanelScrolls,\n          [activePanel]: newPanelScrolls,\n        }\n        : this.state.scrolls;\n\n      this.document.dispatchEvent(createCustomEvent(this.window, transitionEndEventName));\n      this.setState({\n        prevPanel: null,\n        nextPanel: null,\n        visiblePanels: [activePanel],\n        activePanel: activePanel,\n        animated: false,\n        isBack: undefined,\n        scrolls,\n      }, () => {\n        isBack && this.props.scroll.scrollTo(0, scrollPosition);\n        this.props.onTransition && this.props.onTransition({ isBack, from: prevPanel, to: activePanel });\n      });\n    }\n  };\n\n  swipingBackTransitionEndHandler = (e?: TransitionEvent): void => {\n    // indexOf because of vendor prefixes in old browsers\n    if (!e || e.propertyName.includes('transform') && e.target === this.pickPanel(this.state.swipeBackNextPanel)) {\n      switch (this.state.swipeBackResult) {\n        case SwipeBackResults.fail:\n          this.onSwipeBackCancel();\n          break;\n        case SwipeBackResults.success:\n          this.onSwipeBackSuccess();\n      }\n    }\n  };\n\n  onSwipeBackSuccess(): void {\n    this.props.onSwipeBack && this.props.onSwipeBack();\n  }\n\n  onSwipeBackCancel(): void {\n    this.props.onSwipeBackCancel && this.props.onSwipeBackCancel();\n    this.setState({\n      swipeBackPrevPanel: null,\n      swipeBackNextPanel: null,\n      swipingBack: false,\n      swipeBackResult: null,\n      swipebackStartX: 0,\n      swipeBackShift: 0,\n    }, () => {\n      this.document.dispatchEvent(createCustomEvent(this.window, transitionEndEventName));\n    });\n  }\n\n  onMoveX = (e: TouchEvent): void => {\n    const target = e.originalEvent.target as HTMLElement;\n    if (\n      target &&\n      typeof target.tagName === 'string' &&\n      swipeBackExcludedTags.includes(target.tagName.toLowerCase())\n    ) {\n      return;\n    }\n\n    const { platform, configProvider } = this.props;\n\n    if (platform === IOS && !configProvider.isWebView && (e.startX <= 70 || e.startX >= this.window.innerWidth - 70) && !this.state.browserSwipe) {\n      this.setState({ browserSwipe: true });\n    }\n\n    if (platform === IOS && configProvider.isWebView && this.props.onSwipeBack) {\n      if (this.state.animated && e.startX <= 70) {\n        return;\n      }\n\n      if (e.startX <= 70 && !this.state.swipingBack && this.props.history.length > 1) {\n        const prevScrolls = this.state.scrolls[this.state.activePanel] || [];\n        const scrolls = {\n          ...this.state.scrolls,\n          [this.state.activePanel]: [...prevScrolls, this.props.scroll.getScroll().y],\n        };\n\n        this.setState({\n          swipingBack: true,\n          swipebackStartX: e.startX,\n          startT: e.startT,\n          swipeBackPrevPanel: this.state.activePanel,\n          swipeBackNextPanel: this.props.history.slice(-2)[0],\n          scrolls,\n        });\n      }\n      if (this.state.swipingBack) {\n        let swipeBackShift;\n        if (e.shiftX < 0) {\n          swipeBackShift = 0;\n        } else if (e.shiftX > this.window.innerWidth - this.state.swipebackStartX) {\n          swipeBackShift = this.window.innerWidth;\n        } else {\n          swipeBackShift = e.shiftX;\n        }\n        this.setState({ swipeBackShift });\n      }\n    }\n  };\n\n  onEnd = (): void => {\n    if (this.state.swipingBack) {\n      const speed = this.state.swipeBackShift / (Date.now() - this.state.startT.getTime()) * 1000;\n      if (this.state.swipeBackShift === 0) {\n        this.onSwipeBackCancel();\n      } else if (this.state.swipeBackShift >= this.window.innerWidth) {\n        this.onSwipeBackSuccess();\n      } else if (speed > 250 || this.state.swipebackStartX + this.state.swipeBackShift > this.window.innerWidth / 2) {\n        this.setState({ swipeBackResult: SwipeBackResults.success });\n      } else {\n        this.setState({ swipeBackResult: SwipeBackResults.fail });\n      }\n    }\n  };\n\n  calcPanelSwipeStyles(panelId: string): React.CSSProperties {\n    if (!canUseDOM) {\n      return {};\n    }\n\n    const isPrev = panelId === this.state.swipeBackPrevPanel;\n    const isNext = panelId === this.state.swipeBackNextPanel;\n\n    if (!isPrev && !isNext || this.state.swipeBackResult) {\n      return {};\n    }\n\n    let prevPanelTranslate = `${this.state.swipeBackShift}px`;\n    let nextPanelTranslate = `${-50 + this.state.swipeBackShift * 100 / this.window.innerWidth / 2}%`;\n    let prevPanelShadow = 0.3 * (this.window.innerWidth - this.state.swipeBackShift) / this.window.innerWidth;\n\n    if (this.state.swipeBackResult) {\n      return isPrev ? { boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})` } : {};\n    }\n\n    if (isNext) {\n      return {\n        transform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${nextPanelTranslate}, 0, 0)`,\n      };\n    }\n    if (isPrev) {\n      return {\n        transform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        WebkitTransform: `translate3d(${prevPanelTranslate}, 0, 0)`,\n        boxShadow: `-2px 0 12px rgba(0, 0, 0, ${prevPanelShadow})`,\n      };\n    }\n\n    return {};\n  }\n\n  render() {\n    const {\n      popout, modal, platform,\n      activePanel: _1, splitCol, configProvider, history, id, nav,\n      onTransition, onSwipeBack, onSwipeBackStart, onSwipeBackCancel,\n      window, document, scroll, isBackCheck,\n      ...restProps\n    } = this.props;\n    const { prevPanel, nextPanel, activePanel, swipeBackPrevPanel, swipeBackNextPanel, swipeBackResult, swipingBack } = this.state;\n\n    const hasPopout = !!popout;\n    const hasModal = !!modal;\n\n    const panels = this.panels\n      .filter((panel) => {\n        const panelId = getNavId(panel.props, warn);\n\n        return this.state.visiblePanels.includes(panelId) ||\n          panelId === swipeBackPrevPanel ||\n          panelId === swipeBackNextPanel;\n      })\n      .sort((panel) => {\n        const panelId = getNavId(panel.props, warn);\n        const isPrevPanel = panelId === prevPanel || panelId === swipeBackPrevPanel;\n        const isNextPanel = panelId === nextPanel || panelId === swipeBackNextPanel;\n\n        if (isNextPanel) {\n          return swipingBack || this.state.isBack ? -1 : 1;\n        }\n\n        if (isPrevPanel) {\n          return swipingBack || this.state.isBack ? 1 : -1;\n        }\n\n        return 0;\n      });\n\n    const disableAnimation = this.shouldDisableTransitionMotion();\n\n    const modifiers = {\n      'View--animated': !disableAnimation && this.state.animated,\n      'View--swiping-back': !disableAnimation && this.state.swipingBack,\n      'View--no-motion': disableAnimation,\n    };\n\n    return (\n      <Touch\n        Component=\"section\"\n        {...restProps}\n        vkuiClass={classNames(getClassName('View', platform), modifiers)}\n        onMoveX={this.onMoveX}\n        onEnd={this.onEnd}\n      >\n        <div vkuiClass=\"View__panels\">\n          {panels.map((panel: React.ReactElement) => {\n            const panelId = getNavId(panel.props, warn);\n\n            return (\n              <div\n                vkuiClass={classNames('View__panel', {\n                  'View__panel--active': panelId === activePanel,\n                  'View__panel--prev': panelId === prevPanel,\n                  'View__panel--next': panelId === nextPanel,\n                  'View__panel--swipe-back-prev': panelId === swipeBackPrevPanel,\n                  'View__panel--swipe-back-next': panelId === swipeBackNextPanel,\n                  'View__panel--swipe-back-success': swipeBackResult === SwipeBackResults.success,\n                  'View__panel--swipe-back-failed': swipeBackResult === SwipeBackResults.fail,\n                })}\n                ref={(el) => this.panelNodes[panelId] = el}\n                data-vkui-active-panel={panelId === activePanel ? 'true' : ''}\n                style={this.calcPanelSwipeStyles(panelId)}\n                key={panelId}\n              >\n                <div vkuiClass=\"View__panel-in\">\n                  {panel}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n        <AppRootPortal>\n          {hasPopout && <div vkuiClass=\"View__popout\">{popout}</div>}\n          {hasModal && <div vkuiClass=\"View__modal\">{modal}</div>}\n        </AppRootPortal>\n      </Touch>\n    );\n  }\n}\n\nexport default withContext(withContext(\n  withContext(\n    withPlatform(withDOM<ViewInfiniteProps>(ViewInfinite)),\n    SplitColContext, 'splitCol'),\n  ConfigProviderContext, 'configProvider'),\nScrollContext, 'scroll');\n"],"file":"ViewInfinite.js"}