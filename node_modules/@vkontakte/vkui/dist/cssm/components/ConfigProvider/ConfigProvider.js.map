{"version":3,"sources":["../../../../src/components/ConfigProvider/ConfigProvider.tsx"],"names":["React","canUseDOM","useDOM","ConfigProviderContext","Scheme","defaultConfigProviderProps","ExternalScheme","VKCOM","useIsomorphicLayoutEffect","useObjectMemo","noop","warnOnce","useSchemeDetector","node","_scheme","inherit","getScheme","undefined","getAttribute","useState","resolvedScheme","setScheme","useEffect","observer","MutationObserver","observe","attributes","attributeFilter","disconnect","deriveAppearance","scheme","SPACE_GRAY","VKCOM_DARK","normalizeScheme","platform","DEPRECATED_CLIENT_LIGHT","BRIGHT_LIGHT","DEPRECATED_CLIENT_DARK","warn","ConfigProvider","children","schemeTarget","config","document","target","body","process","env","NODE_ENV","hasAttribute","setAttribute","removeAttribute","realScheme","configContext","appearance","defaultProps"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { AppearanceType } from '@vkontakte/vk-bridge';\nimport { canUseDOM, useDOM } from '../../lib/dom';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  Scheme,\n  AppearanceScheme,\n  defaultConfigProviderProps,\n  ExternalScheme,\n} from './ConfigProviderContext';\nimport { PlatformType, VKCOM } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { noop } from '../../lib/utils';\nimport { warnOnce } from '../../lib/warnOnce';\n\nexport interface ConfigProviderProps extends ConfigProviderContextInterface {\n  /**\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n}\n\nfunction useSchemeDetector(node: HTMLElement, _scheme: Scheme | 'inherit') {\n  const inherit = _scheme === 'inherit';\n  const getScheme = () => {\n    if (!inherit || !canUseDOM) {\n      return undefined;\n    }\n    return node.getAttribute('scheme') as Scheme | ExternalScheme;\n  };\n  const [resolvedScheme, setScheme] = React.useState(getScheme());\n\n  React.useEffect(() => {\n    if (!inherit) {\n      return noop;\n    }\n    setScheme(getScheme());\n    const observer = new MutationObserver(() => setScheme(getScheme()));\n    observer.observe(node, { attributes: true, attributeFilter: ['scheme'] });\n    return () => observer.disconnect();\n  }, [inherit]);\n\n  return _scheme === 'inherit' ? resolvedScheme : _scheme;\n}\n\nconst deriveAppearance = (scheme: Scheme | ExternalScheme): AppearanceType =>\n  scheme === Scheme.SPACE_GRAY || scheme === ExternalScheme.VKCOM_DARK ? 'dark' : 'light';\n\nfunction normalizeScheme(scheme: AppearanceScheme, platform: PlatformType): Scheme | 'inherit' {\n  if (scheme === 'inherit') {\n    return scheme;\n  }\n  if (platform === VKCOM) {\n    return Scheme.VKCOM;\n  }\n  switch (scheme) {\n    case Scheme.DEPRECATED_CLIENT_LIGHT:\n      return Scheme.BRIGHT_LIGHT;\n    case Scheme.DEPRECATED_CLIENT_DARK:\n      return Scheme.SPACE_GRAY;\n    default:\n      return scheme as Scheme;\n  }\n}\n\nconst warn = warnOnce('ConfigProvider');\n\nconst ConfigProvider: React.FC<ConfigProviderProps> = ({\n  children,\n  schemeTarget,\n  ...config\n}: ConfigProviderProps & { children?: React.ReactNode; schemeTarget?: HTMLElement }) => {\n  const scheme = normalizeScheme(config.scheme, config.platform);\n  const { document } = useDOM();\n  const target = schemeTarget || document?.body;\n\n  useIsomorphicLayoutEffect(() => {\n    if (scheme === 'inherit') {\n      return noop;\n    }\n    if (process.env.NODE_ENV === 'development' && target.hasAttribute('scheme')) {\n      warn('<body scheme> was set before VKUI mount - did you forget scheme=\"inherit\"?');\n    }\n    target.setAttribute('scheme', scheme);\n    return () => target.removeAttribute('scheme');\n  }, [scheme]);\n\n  const realScheme = useSchemeDetector(target, scheme);\n  const configContext = useObjectMemo({ appearance: deriveAppearance(realScheme), ...config });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      {children}\n    </ConfigProviderContext.Provider>\n  );\n};\n\n// Деструктуризация нужна из бага в react-docgen-typescript\n// https://github.com/styleguidist/react-docgen-typescript/issues/195\nConfigProvider.defaultProps = { ...defaultConfigProviderProps };\n\nexport default ConfigProvider;\n"],"file":"ConfigProvider.js"}