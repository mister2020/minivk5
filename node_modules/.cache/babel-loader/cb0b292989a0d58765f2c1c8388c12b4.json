{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"children\", \"className\", \"header\", \"text\", \"style\", \"iosCloseItem\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from 'react';\nimport { PopoutWrapper } from \"../PopoutWrapper/PopoutWrapper\";\nimport { ViewWidth, ViewHeight } from \"../../hoc/withAdaptivity\";\nimport { IOS } from \"../../lib/platform\";\nimport { ActionSheetDropdownDesktop } from \"./ActionSheetDropdownDesktop\";\nimport { ActionSheetDropdown } from \"./ActionSheetDropdown\";\nimport { hasReactNode } from \"../../lib/utils\";\nimport { ActionSheetContext } from \"./ActionSheetContext\";\nimport Caption from \"../Typography/Caption/Caption\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { useTimeout } from \"../../hooks/useTimeout\";\nimport { useAdaptivity } from \"../../hooks/useAdaptivity\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nexport var ActionSheet = function ActionSheet(_ref) {\n  var children = _ref.children,\n      className = _ref.className,\n      header = _ref.header,\n      text = _ref.text,\n      style = _ref.style,\n      iosCloseItem = _ref.iosCloseItem,\n      restProps = _objectWithoutProperties(_ref, _excluded);\n\n  var platform = usePlatform();\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      closing = _React$useState2[0],\n      setClosing = _React$useState2[1];\n\n  var onClose = function onClose() {\n    return setClosing(true);\n  };\n\n  var _React$useState3 = React.useState(),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      _closeAction = _React$useState4[0],\n      setCloseAction = _React$useState4[1];\n\n  var afterClose = function afterClose() {\n    restProps.onClose();\n    _closeAction && _closeAction();\n    setCloseAction(undefined);\n  };\n\n  var _useAdaptivity = useAdaptivity(),\n      viewWidth = _useAdaptivity.viewWidth,\n      viewHeight = _useAdaptivity.viewHeight,\n      hasMouse = _useAdaptivity.hasMouse;\n\n  var isDesktop = viewWidth >= ViewWidth.SMALL_TABLET && (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n  var fallbackTransitionFinish = useTimeout(afterClose, platform === IOS ? 300 : 200);\n  React.useEffect(function () {\n    if (closing) {\n      if (isDesktop) {\n        afterClose();\n      } else {\n        fallbackTransitionFinish.set();\n      }\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing]);\n  var onItemClick = React.useCallback(function (action, autoclose) {\n    return function (event) {\n      event.persist();\n\n      if (autoclose) {\n        setCloseAction(function () {\n          return action && action(event);\n        });\n        setClosing(true);\n      } else {\n        action && action(event);\n      }\n    };\n  }, []);\n  var contextValue = useObjectMemo({\n    onItemClick: onItemClick,\n    isDesktop: isDesktop\n  });\n  var DropdownComponent = isDesktop ? ActionSheetDropdownDesktop : ActionSheetDropdown;\n  return createScopedElement(PopoutWrapper, {\n    closing: closing,\n    alignY: \"bottom\",\n    className: className,\n    style: style,\n    onClick: !isDesktop ? onClose : null,\n    hasMask: !isDesktop,\n    fixed: !isDesktop\n  }, createScopedElement(ActionSheetContext.Provider, {\n    value: contextValue\n  }, createScopedElement(DropdownComponent, _extends({\n    closing: closing,\n    onClose: onClose,\n    onTransitionEnd: closing && !isDesktop ? afterClose : null\n  }, restProps), (hasReactNode(header) || hasReactNode(text)) && createScopedElement(\"header\", {\n    vkuiClass: \"ActionSheet__header\"\n  }, hasReactNode(header) && createScopedElement(Caption, {\n    level: \"1\",\n    weight: platform === IOS ? 'semibold' : 'medium',\n    vkuiClass: \"ActionSheet__title\"\n  }, header), hasReactNode(text) && createScopedElement(Caption, {\n    level: \"1\",\n    weight: \"regular\",\n    vkuiClass: \"ActionSheet__text\"\n  }, text)), children, platform === IOS && !isDesktop && iosCloseItem)));\n};\nActionSheet.defaultProps = {\n  popupDirection: 'bottom'\n};","map":{"version":3,"sources":["../../../src/components/ActionSheet/ActionSheet.tsx"],"names":["ActionSheet","children","className","header","text","style","iosCloseItem","restProps","platform","usePlatform","closing","setClosing","React","onClose","_closeAction","setCloseAction","afterClose","viewWidth","viewHeight","hasMouse","useAdaptivity","isDesktop","ViewWidth","ViewHeight","fallbackTransitionFinish","useTimeout","onItemClick","event","action","contextValue","useObjectMemo","DropdownComponent","hasReactNode","popupDirection"],"mappings":";;;;;AAAA,OAAO,KAAP,KAAA,MAAA,OAAA;AACA,SAAA,aAAA,QAAA,gCAAA;AACA,SAAA,SAAA,EAAA,UAAA,QAAA,0BAAA;AACA,SAAA,GAAA,QAAA,oBAAA;AACA,SAAA,0BAAA,QAAA,8BAAA;AACA,SAAA,mBAAA,QAAA,uBAAA;AACA,SAAA,YAAA,QAAA,iBAAA;AACA,SAAA,kBAAA,QAAA,sBAAA;AACA,OAAA,OAAA,MAAA,+BAAA;AACA,SAAA,WAAA,QAAA,yBAAA;AACA,SAAA,UAAA,QAAA,wBAAA;AACA,SAAA,aAAA,QAAA,2BAAA;AACA,SAAA,aAAA,QAAA,2BAAA;AAyBA,OAAO,IAAMA,WAAuC,GAAG,SAA1CA,WAA0C,CAAA,IAAA,EAQjD;AAAA,MAPJC,QAOI,GAAA,IAAA,CAPJA,QAOI;AAAA,MANJC,SAMI,GAAA,IAAA,CANJA,SAMI;AAAA,MALJC,MAKI,GAAA,IAAA,CALJA,MAKI;AAAA,MAJJC,IAII,GAAA,IAAA,CAJJA,IAII;AAAA,MAHJC,KAGI,GAAA,IAAA,CAHJA,KAGI;AAAA,MAFJC,YAEI,GAAA,IAAA,CAFJA,YAEI;AAAA,MADDC,SACC,GAAA,wBAAA,CAAA,IAAA,EAAA,SAAA,CAAA;;AACJ,MAAMC,QAAQ,GAAGC,WAAjB,EAAA;;AACA,MAAA,eAAA,GAA8BG,KAAK,CAALA,QAAAA,CAA9B,KAA8BA,CAA9B;AAAA,MAAA,gBAAA,GAAA,cAAA,CAAA,eAAA,EAAA,CAAA,CAAA;AAAA,MAAOF,OAAP,GAAA,gBAAA,CAAA,CAAA,CAAA;AAAA,MAAgBC,UAAhB,GAAA,gBAAA,CAAA,CAAA,CAAA;;AACA,MAAME,OAAO,GAAG,SAAVA,OAAU,GAAA;AAAA,WAAMF,UAAU,CAAhB,IAAgB,CAAhB;AAAhB,GAAA;;AAEA,MAAA,gBAAA,GAAuCC,KAAK,CAA5C,QAAuCA,EAAvC;AAAA,MAAA,gBAAA,GAAA,cAAA,CAAA,gBAAA,EAAA,CAAA,CAAA;AAAA,MAAOE,YAAP,GAAA,gBAAA,CAAA,CAAA,CAAA;AAAA,MAAqBC,cAArB,GAAA,gBAAA,CAAA,CAAA,CAAA;;AACA,MAAMC,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvBT,IAAAA,SAAS,CAATA,OAAAA;AACAO,IAAAA,YAAY,IAAIA,YAAhBA,EAAAA;AACAC,IAAAA,cAAc,CAAdA,SAAc,CAAdA;AAHF,GAAA;;AAMA,MAAA,cAAA,GAA4CK,aAA5C,EAAA;AAAA,MAAQH,SAAR,GAAA,cAAA,CAAA,SAAA;AAAA,MAAmBC,UAAnB,GAAA,cAAA,CAAA,UAAA;AAAA,MAA+BC,QAA/B,GAAA,cAAA,CAAA,QAAA;;AACA,MAAME,SAAS,GAAGJ,SAAS,IAAIK,SAAS,CAAtBL,YAAAA,KAAwCE,QAAQ,IAAID,UAAU,IAAIK,UAAU,CAA9F,MAAkBN,CAAlB;AAEA,MAAMO,wBAAwB,GAAGC,UAAU,CAAA,UAAA,EAAajB,QAAQ,KAARA,GAAAA,GAAAA,GAAAA,GAAxD,GAA2C,CAA3C;AACAI,EAAAA,KAAK,CAALA,SAAAA,CAAgB,YAAM;AACpB,QAAA,OAAA,EAAa;AACX,UAAA,SAAA,EAAe;AACbI,QAAAA,UAAU;AADZ,OAAA,MAEO;AACLQ,QAAAA,wBAAwB,CAAxBA,GAAAA;AACD;AALH,KAAA,MAMO;AACLA,MAAAA,wBAAwB,CAAxBA,KAAAA;AACD;AATHZ,GAAAA,EAUG,CAVHA,OAUG,CAVHA;AAYA,MAAMc,WAAW,GAAG,KAAK,CAAL,WAAA,CAAoC,UAAA,MAAA,EAAA,SAAA,EAAA;AAAA,WAAuB,UAAA,KAAA,EAAW;AACxFC,MAAAA,KAAK,CAALA,OAAAA;;AAEA,UAAA,SAAA,EAAe;AACbZ,QAAAA,cAAc,CAAC,YAAA;AAAA,iBAAMa,MAAM,IAAIA,MAAM,CAAtB,KAAsB,CAAtB;AAAfb,SAAc,CAAdA;AACAJ,QAAAA,UAAU,CAAVA,IAAU,CAAVA;AAFF,OAAA,MAGO;AACLiB,QAAAA,MAAM,IAAIA,MAAM,CAAhBA,KAAgB,CAAhBA;AACD;AARqD,KAAA;AAApC,GAAA,EAApB,EAAoB,CAApB;AAUA,MAAMC,YAAY,GAAGC,aAAa,CAAC;AAAEJ,IAAAA,WAAW,EAAb,WAAA;AAAeL,IAAAA,SAAS,EAATA;AAAf,GAAD,CAAlC;AAEA,MAAMU,iBAAiB,GAAGV,SAAS,GAAA,0BAAA,GAAnC,mBAAA;AAIA,SACE,mBAAA,CAAA,aAAA,EAAA;AACE,IAAA,OAAO,EADT,OAAA;AAEE,IAAA,MAAM,EAFR,QAAA;AAGE,IAAA,SAAS,EAHX,SAAA;AAIE,IAAA,KAAK,EAJP,KAAA;AAKE,IAAA,OAAO,EAAE,CAAA,SAAA,GAAA,OAAA,GALX,IAAA;AAME,IAAA,OAAO,EAAE,CANX,SAAA;AAOE,IAAA,KAAK,EAAE,CAACA;AAPV,GAAA,EASE,mBAAA,CAAC,kBAAD,CAAA,QAAA,EAAA;AAA6B,IAAA,KAAK,EAAEQ;AAApC,GAAA,EACE,mBAAA,CAAA,iBAAA,EAAA,QAAA,CAAA;AACE,IAAA,OAAO,EADT,OAAA;AAEE,IAAA,OAAO,EAFT,OAAA;AAGE,IAAA,eAAe,EAAEnB,OAAO,IAAI,CAAXA,SAAAA,GAAAA,UAAAA,GAAqC;AAHxD,GAAA,EAAA,SAAA,CAAA,EAMG,CAACsB,YAAY,CAAZA,MAAY,CAAZA,IAAwBA,YAAY,CAArC,IAAqC,CAArC,KACC,mBAAA,CAAA,QAAA,EAAA;AAAQ,IAAA,SAAS,EAAC;AAAlB,GAAA,EACGA,YAAY,CAAZA,MAAY,CAAZA,IACC,mBAAA,CAAA,OAAA,EAAA;AAAS,IAAA,KAAK,EAAd,GAAA;AAAmB,IAAA,MAAM,EAAExB,QAAQ,KAARA,GAAAA,GAAAA,UAAAA,GAA3B,QAAA;AAAqE,IAAA,SAAS,EAAC;AAA/E,GAAA,EAFJ,MAEI,CAFJ,EAMGwB,YAAY,CAAZA,IAAY,CAAZA,IAAsB,mBAAA,CAAA,OAAA,EAAA;AAAS,IAAA,KAAK,EAAd,GAAA;AAAmB,IAAA,MAAM,EAAzB,SAAA;AAAoC,IAAA,SAAS,EAAC;AAA9C,GAAA,EAb7B,IAa6B,CANzB,CAPJ,EAAA,QAAA,EAiBGxB,QAAQ,KAARA,GAAAA,IAAoB,CAApBA,SAAAA,IA5BT,YAWM,CADF,CATF,CADF;AApDK,CAAA;AAuFPR,WAAW,CAAXA,YAAAA,GAA2B;AACzBiC,EAAAA,cAAc,EAAE;AADS,CAA3BjC","sourcesContent":["import * as React from 'react';\nimport { PopoutWrapper } from '../PopoutWrapper/PopoutWrapper';\nimport { ViewWidth, ViewHeight } from '../../hoc/withAdaptivity';\nimport { IOS } from '../../lib/platform';\nimport { ActionSheetDropdownDesktop } from './ActionSheetDropdownDesktop';\nimport { ActionSheetDropdown } from './ActionSheetDropdown';\nimport { hasReactNode } from '../../lib/utils';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport Caption from '../Typography/Caption/Caption';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { useTimeout } from '../../hooks/useTimeout';\nimport { useAdaptivity } from '../../hooks/useAdaptivity';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport './ActionSheet.css';\n\nexport type PopupDirectionFunction = (elRef: React.RefObject<HTMLDivElement>) => 'top' | 'bottom';\n\nexport interface ActionSheetProps extends React.HTMLAttributes<HTMLDivElement> {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose?: VoidFunction;\n  /**\n   * Desktop only\n   */\n  toggleRef: Element;\n  /**\n   * Desktop only\n   */\n  popupDirection?: 'top' | 'bottom' | PopupDirectionFunction;\n  /**\n   * iOS only\n   */\n  iosCloseItem: React.ReactNode;\n}\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nexport const ActionSheet: React.FC<ActionSheetProps> = ({\n  children,\n  className,\n  header,\n  text,\n  style,\n  iosCloseItem,\n  ...restProps\n}) => {\n  const platform = usePlatform();\n  const [closing, setClosing] = React.useState(false);\n  const onClose = () => setClosing(true);\n\n  const [_closeAction, setCloseAction] = React.useState<VoidFunction>();\n  const afterClose = () => {\n    restProps.onClose();\n    _closeAction && _closeAction();\n    setCloseAction(undefined);\n  };\n\n  const { viewWidth, viewHeight, hasMouse } = useAdaptivity();\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET && (hasMouse || viewHeight >= ViewHeight.MEDIUM);\n\n  const fallbackTransitionFinish = useTimeout(afterClose, platform === IOS ? 300 : 200);\n  React.useEffect(() => {\n    if (closing) {\n      if (isDesktop) {\n        afterClose();\n      } else {\n        fallbackTransitionFinish.set();\n      }\n    } else {\n      fallbackTransitionFinish.clear();\n    }\n  }, [closing]);\n\n  const onItemClick = React.useCallback<ItemClickHandler>((action, autoclose) => (event) => {\n    event.persist();\n\n    if (autoclose) {\n      setCloseAction(() => action && action(event));\n      setClosing(true);\n    } else {\n      action && action(event);\n    }\n  }, []);\n  const contextValue = useObjectMemo({ onItemClick, isDesktop });\n\n  const DropdownComponent = isDesktop\n    ? ActionSheetDropdownDesktop\n    : ActionSheetDropdown;\n\n  return (\n    <PopoutWrapper\n      closing={closing}\n      alignY=\"bottom\"\n      className={className}\n      style={style}\n      onClick={!isDesktop ? onClose : null}\n      hasMask={!isDesktop}\n      fixed={!isDesktop}\n    >\n      <ActionSheetContext.Provider value={contextValue}>\n        <DropdownComponent\n          closing={closing}\n          onClose={onClose}\n          onTransitionEnd={closing && !isDesktop ? afterClose : null}\n          {...restProps}\n        >\n          {(hasReactNode(header) || hasReactNode(text)) &&\n            <header vkuiClass=\"ActionSheet__header\">\n              {hasReactNode(header) &&\n                <Caption level=\"1\" weight={platform === IOS ? 'semibold' : 'medium'} vkuiClass=\"ActionSheet__title\">\n                  {header}\n                </Caption>\n              }\n              {hasReactNode(text) && <Caption level=\"1\" weight=\"regular\" vkuiClass=\"ActionSheet__text\">{text}</Caption>}\n            </header>\n          }\n          {children}\n          {platform === IOS && !isDesktop && iosCloseItem}\n        </DropdownComponent>\n      </ActionSheetContext.Provider>\n    </PopoutWrapper>\n  );\n};\n\nActionSheet.defaultProps = {\n  popupDirection: 'bottom',\n};\n"]},"metadata":{},"sourceType":"module"}