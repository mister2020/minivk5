{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nvar _excluded = [\"onRemove\", \"removePlaceholder\", \"onDragFinish\", \"className\", \"style\", \"before\", \"after\", \"disabled\", \"removable\", \"draggable\", \"selectable\", \"Component\", \"onChange\", \"name\", \"checked\", \"defaultChecked\", \"getRootRef\"];\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport * as React from 'react';\nimport { classNames } from \"../../lib/classNames\";\nimport { getClassName } from \"../../helpers/getClassName\";\nimport Touch from \"../Touch/Touch\";\nimport { ANDROID, IOS, VKCOM } from \"../../lib/platform\";\nimport { Icon24Reorder, Icon24ReorderIos, Icon24CheckCircleOn, Icon24CheckCircleOff, Icon24CheckBoxOff, Icon24CheckBoxOn } from '@vkontakte/icons';\nimport SimpleCell from \"../SimpleCell/SimpleCell\";\nimport { Removable } from \"../Removable/Removable\";\nimport { usePlatform } from \"../../hooks/usePlatform\";\nimport { ListContext } from \"../../components/List/ListContext\";\nexport var Cell = function Cell(props) {\n  var _onRemove = props.onRemove,\n      removePlaceholder = props.removePlaceholder,\n      onDragFinish = props.onDragFinish,\n      className = props.className,\n      style = props.style,\n      before = props.before,\n      after = props.after,\n      disabled = props.disabled,\n      removable = props.removable,\n      draggable = props.draggable,\n      selectable = props.selectable,\n      Component = props.Component,\n      onChange = props.onChange,\n      name = props.name,\n      checked = props.checked,\n      defaultChecked = props.defaultChecked,\n      getRootRef = props.getRootRef,\n      restProps = _objectWithoutProperties(props, _excluded);\n\n  var rootElRef = React.useRef(null);\n  var platform = usePlatform();\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      dragging = _React$useState2[0],\n      setDragging = _React$useState2[1];\n\n  var _React$useState3 = React.useState(undefined),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      siblings = _React$useState4[0],\n      setSiblings = _React$useState4[1];\n\n  var _React$useState5 = React.useState(undefined),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      dragStartIndex = _React$useState6[0],\n      setDragStartIndex = _React$useState6[1];\n\n  var _React$useState7 = React.useState(undefined),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      dragEndIndex = _React$useState8[0],\n      setDragEndIndex = _React$useState8[1];\n\n  var _React$useState9 = React.useState(0),\n      _React$useState10 = _slicedToArray(_React$useState9, 2),\n      dragShift = _React$useState10[0],\n      setDragShift = _React$useState10[1];\n\n  var _React$useState11 = React.useState(undefined),\n      _React$useState12 = _slicedToArray(_React$useState11, 2),\n      dragDirection = _React$useState12[0],\n      setDragDirection = _React$useState12[1];\n\n  var onDragStart = function onDragStart() {\n    var rootEl = rootElRef === null || rootElRef === void 0 ? void 0 : rootElRef.current;\n    setDragging(true);\n\n    var _siblings = Array.from(rootEl.parentElement.childNodes);\n\n    var rootElIdx = _siblings.indexOf(rootEl);\n\n    setDragStartIndex(rootElIdx);\n    setDragEndIndex(rootElIdx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n\n  var onDragMove = function onDragMove(e) {\n    e.originalEvent.preventDefault();\n    var rootEl = rootElRef === null || rootElRef === void 0 ? void 0 : rootElRef.current;\n    rootEl.style.transform = \"translateY(\".concat(e.shiftY, \"px)\");\n    setDragDirection(dragShift - e.shiftY < 0 ? 'down' : 'up');\n    setDragShift(e.shiftY);\n    setDragEndIndex(dragStartIndex);\n    siblings.forEach(function (sibling, siblingIndex) {\n      var rootGesture = rootEl.getBoundingClientRect();\n      var siblingGesture = sibling.getBoundingClientRect();\n\n      if (dragStartIndex < siblingIndex) {\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2) {\n          if (dragDirection === 'down') {\n            sibling.style.transform = 'translateY(-100%)';\n          }\n\n          setDragEndIndex(function (dragEndIndex) {\n            return dragEndIndex + 1;\n          });\n        }\n\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2 && dragDirection === 'up') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      } else if (dragStartIndex > siblingIndex) {\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2) {\n          if (dragDirection === 'up') {\n            sibling.style.transform = 'translateY(100%)';\n          }\n\n          setDragEndIndex(function (dragEndIndex) {\n            return dragEndIndex - 1;\n          });\n        }\n\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2 && dragDirection === 'down') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      }\n    });\n  };\n\n  var onDragEnd = function onDragEnd() {\n    var from = dragStartIndex,\n        to = dragEndIndex;\n    siblings.forEach(function (sibling) {\n      sibling.style.transform = null;\n    });\n    setSiblings(undefined);\n    setDragEndIndex(undefined);\n    setDragStartIndex(undefined);\n    setDragDirection(undefined);\n    setDragShift(undefined);\n    setDragging(false);\n    props.onDragFinish && props.onDragFinish({\n      from: from,\n      to: to\n    });\n  };\n\n  var onDragClick = function onDragClick(e) {\n    e.nativeEvent.stopPropagation();\n    e.preventDefault();\n  };\n\n  var _React$useContext = React.useContext(ListContext),\n      toggleDrag = _React$useContext.toggleDrag;\n\n  React.useEffect(function () {\n    if (dragging) {\n      toggleDrag(true);\n      return function () {\n        return toggleDrag(false);\n      };\n    }\n\n    return undefined;\n  }, [dragging]);\n  var IconOff = platform === ANDROID ? Icon24CheckBoxOff : Icon24CheckCircleOff;\n  var IconOn = platform === ANDROID ? Icon24CheckBoxOn : Icon24CheckCircleOn;\n  var simpleCell = createScopedElement(SimpleCell, _extends({}, restProps, {\n    disabled: draggable || removable || disabled,\n    Component: selectable ? 'label' : Component,\n    htmlFor: selectable ? name : undefined,\n    before: createScopedElement(React.Fragment, null, (platform === ANDROID || platform === VKCOM) && draggable && createScopedElement(Touch, {\n      vkuiClass: \"Cell__dragger\",\n      onStart: onDragStart,\n      onMoveY: onDragMove,\n      onEnd: onDragEnd,\n      onClick: onDragClick\n    }, createScopedElement(Icon24Reorder, null)), selectable && createScopedElement(React.Fragment, null, createScopedElement(\"input\", {\n      type: \"checkbox\",\n      vkuiClass: \"Cell__checkbox\",\n      name: name,\n      onChange: onChange,\n      defaultChecked: defaultChecked,\n      checked: checked,\n      disabled: disabled\n    }), createScopedElement(\"span\", {\n      vkuiClass: \"Cell__marker\"\n    }, createScopedElement(IconOff, {\n      vkuiClass: \"Cell__marker-in\"\n    }), createScopedElement(IconOn, {\n      vkuiClass: \"Cell__marker-in Cell__marker-in--checked\"\n    }))), before),\n    after: createScopedElement(React.Fragment, null, platform === IOS && draggable && createScopedElement(Touch, {\n      vkuiClass: \"Cell__dragger\",\n      onStart: onDragStart,\n      onMoveY: onDragMove,\n      onEnd: onDragEnd,\n      onClick: onDragClick\n    }, createScopedElement(Icon24ReorderIos, null)), after)\n  }));\n  return createScopedElement(\"div\", {\n    vkuiClass: classNames(getClassName('Cell', platform), {\n      'Cell--dragging': dragging,\n      'Cell--removable': removable,\n      'Cell--selectable': selectable,\n      'Cell--disabled': disabled\n    }),\n    className: className,\n    style: style,\n    ref: rootElRef\n  }, removable ? createScopedElement(Removable, {\n    removePlaceholder: removePlaceholder,\n    onRemove: function onRemove(e) {\n      return _onRemove(e, rootElRef === null || rootElRef === void 0 ? void 0 : rootElRef.current);\n    }\n  }, simpleCell) : simpleCell);\n};\nCell.defaultProps = {\n  removePlaceholder: 'Удалить'\n};","map":{"version":3,"sources":["../../../src/components/Cell/Cell.tsx"],"names":["Cell","onRemove","removePlaceholder","onDragFinish","className","style","before","after","disabled","removable","draggable","selectable","Component","onChange","name","checked","defaultChecked","getRootRef","restProps","props","rootElRef","React","platform","usePlatform","dragging","setDragging","siblings","setSiblings","dragStartIndex","setDragStartIndex","dragEndIndex","setDragEndIndex","dragShift","setDragShift","dragDirection","setDragDirection","onDragStart","rootEl","_siblings","Array","rootElIdx","onDragMove","e","rootGesture","siblingGesture","sibling","onDragEnd","from","to","onDragClick","toggleDrag","IconOff","IconOn","simpleCell","classNames","getClassName"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { getClassName } from '../../helpers/getClassName';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport { ANDROID, IOS, VKCOM } from '../../lib/platform';\nimport { Icon24Reorder, Icon24ReorderIos, Icon24CheckCircleOn, Icon24CheckCircleOff, Icon24CheckBoxOff, Icon24CheckBoxOn } from '@vkontakte/icons';\nimport SimpleCell, { SimpleCellProps } from '../SimpleCell/SimpleCell';\nimport { HasPlatform } from '../../types';\nimport { Removable, RemovableProps } from '../Removable/Removable';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { ListContext } from '../../components/List/ListContext';\nimport './Cell.css';\n\nexport interface CellProps extends SimpleCellProps, HasPlatform, RemovableProps {\n  /**\n   * В режиме перетаскивания ячейка перестает быть кликабельной, то есть при клике переданный onClick вызываться не будет\n   */\n  draggable?: boolean;\n  removable?: boolean;\n  /**\n   * Имя для input в режиме selectable\n   */\n  name?: string;\n  selectable?: boolean;\n  /**\n   * В режиме selectable реагирует на входящие значения пропса cheсked, как зависящий напрямую от входящего значения\n   */\n  checked?: boolean;\n  /**\n   * В режиме selectable реагирует на входящие значения пропса defaultChecked как неконтролируемый компонент\n   */\n  defaultChecked?: boolean;\n  /**\n   * Коллбэк срабатывает при завершении перетаскивания.\n   * **Важно:** режим перетаскивания не меняет порядок ячеек в DOM. В коллбэке есть объект с полями `from` и `to`.\n   * Эти числа нужны для того, чтобы разработчик понимал, с какого индекса на какой произошел переход. В песочнице\n   * есть рабочий пример с обработкой этих чисел и перерисовкой списка.\n   */\n  onDragFinish?: ({ from, to }: { from: number; to: number }) => void;\n}\n\nexport const Cell: React.FC<CellProps> = (props: CellProps) => {\n  const {\n    onRemove,\n    removePlaceholder,\n    onDragFinish,\n    className,\n    style,\n    before,\n    after,\n    disabled,\n    removable,\n    draggable,\n    selectable,\n    Component,\n    onChange,\n    name,\n    checked,\n    defaultChecked,\n    getRootRef,\n    ...restProps\n  } = props;\n  const rootElRef = React.useRef(null);\n  const platform = usePlatform();\n\n  const [dragging, setDragging] = React.useState<boolean>(false);\n\n  const [siblings, setSiblings] = React.useState<HTMLElement[]>(undefined);\n  const [dragStartIndex, setDragStartIndex] = React.useState<number>(undefined);\n  const [dragEndIndex, setDragEndIndex] = React.useState<number>(undefined);\n  const [dragShift, setDragShift] = React.useState<number>(0);\n  const [dragDirection, setDragDirection] = React.useState<'down' | 'up'>(undefined);\n\n  const onDragStart = () => {\n    const rootEl = rootElRef?.current;\n\n    setDragging(true);\n\n    const _siblings: HTMLElement[] = Array.from(rootEl.parentElement.childNodes);\n    const rootElIdx = _siblings.indexOf(rootEl);\n\n    setDragStartIndex(rootElIdx);\n    setDragEndIndex(rootElIdx);\n    setSiblings(_siblings);\n    setDragShift(0);\n  };\n\n  const onDragMove = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n\n    const rootEl = rootElRef?.current;\n\n    rootEl.style.transform = `translateY(${e.shiftY}px)`;\n    setDragDirection(dragShift - e.shiftY < 0 ? 'down' : 'up');\n    setDragShift(e.shiftY);\n    setDragEndIndex(dragStartIndex);\n\n    siblings.forEach((sibling: HTMLElement, siblingIndex: number) => {\n      const rootGesture = rootEl.getBoundingClientRect();\n\n      const siblingGesture = sibling.getBoundingClientRect();\n\n      if (dragStartIndex < siblingIndex) {\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2) {\n          if (dragDirection === 'down') {\n            sibling.style.transform = 'translateY(-100%)';\n          }\n\n          setDragEndIndex((dragEndIndex) => dragEndIndex + 1);\n        }\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2 && dragDirection === 'up') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      } else if (dragStartIndex > siblingIndex) {\n        if (rootGesture.top < siblingGesture.bottom - siblingGesture.height / 2) {\n          if (dragDirection === 'up') {\n            sibling.style.transform = 'translateY(100%)';\n          }\n\n          setDragEndIndex((dragEndIndex) => dragEndIndex - 1);\n        }\n        if (rootGesture.bottom > siblingGesture.top + siblingGesture.height / 2 && dragDirection === 'down') {\n          sibling.style.transform = 'translateY(0)';\n        }\n      }\n    });\n  };\n\n  const onDragEnd = () => {\n    const [from, to] = [dragStartIndex, dragEndIndex];\n\n    siblings.forEach((sibling: HTMLElement) => {\n      sibling.style.transform = null;\n    });\n\n    setSiblings(undefined);\n    setDragEndIndex(undefined);\n    setDragStartIndex(undefined);\n    setDragDirection(undefined);\n    setDragShift(undefined);\n\n    setDragging(false);\n\n    props.onDragFinish && props.onDragFinish({ from, to });\n  };\n\n  const onDragClick = (e: React.MouseEvent) => {\n    e.nativeEvent.stopPropagation();\n    e.preventDefault();\n  };\n\n  const { toggleDrag } = React.useContext(ListContext);\n  React.useEffect(() => {\n    if (dragging) {\n      toggleDrag(true);\n      return () => toggleDrag(false);\n    }\n    return undefined;\n  }, [dragging]);\n\n  const IconOff = platform === ANDROID ? Icon24CheckBoxOff : Icon24CheckCircleOff;\n  const IconOn = platform === ANDROID ? Icon24CheckBoxOn : Icon24CheckCircleOn;\n\n  const simpleCell = (\n    <SimpleCell\n      {...restProps}\n      disabled={draggable || removable || disabled}\n      Component={selectable ? 'label' : Component}\n      htmlFor={selectable ? name : undefined}\n      before={\n        <React.Fragment>\n          {(platform === ANDROID || platform === VKCOM) && draggable && (\n            <Touch\n              vkuiClass=\"Cell__dragger\"\n              onStart={onDragStart}\n              onMoveY={onDragMove}\n              onEnd={onDragEnd}\n              onClick={onDragClick}\n            ><Icon24Reorder /></Touch>\n          )}\n          {selectable && (\n            <React.Fragment>\n              <input\n                type=\"checkbox\"\n                vkuiClass=\"Cell__checkbox\"\n                name={name}\n                onChange={onChange}\n                defaultChecked={defaultChecked}\n                checked={checked}\n                disabled={disabled}\n              />\n              <span vkuiClass=\"Cell__marker\">\n                <IconOff vkuiClass=\"Cell__marker-in\" />\n                <IconOn vkuiClass=\"Cell__marker-in Cell__marker-in--checked\" />\n              </span>\n            </React.Fragment>\n          )}\n          {before}\n        </React.Fragment>\n      }\n      after={\n        <React.Fragment>\n          {platform === IOS && draggable && (\n            <Touch\n              vkuiClass=\"Cell__dragger\"\n              onStart={onDragStart}\n              onMoveY={onDragMove}\n              onEnd={onDragEnd}\n              onClick={onDragClick}\n            ><Icon24ReorderIos /></Touch>\n          )}\n          {after}\n        </React.Fragment>\n      }\n    />\n  );\n\n  return (\n    <div\n      vkuiClass={classNames(getClassName('Cell', platform), {\n        'Cell--dragging': dragging,\n        'Cell--removable': removable,\n        'Cell--selectable': selectable,\n        'Cell--disabled': disabled,\n      })}\n      className={className}\n      style={style}\n      ref={rootElRef}\n    >\n      {removable\n        ? <Removable removePlaceholder={removePlaceholder} onRemove={(e) => onRemove(e, rootElRef?.current)}>{simpleCell}</Removable>\n        : simpleCell\n      }\n    </div>\n  );\n};\n\nCell.defaultProps = {\n  removePlaceholder: 'Удалить',\n};\n"]},"metadata":{},"sourceType":"module"}